<div class="pageTitle" *ngIf="this.detail">
  <h1>排程管理</h1>
  <button nbButton [status]="this.detail.status === 'reviewing' ? 'basic' : 'info'" size="tiny" class="iconBtn" (click)="edit()" [disabled]="this.detail.status === 'reviewing'">
      <nb-icon icon="edit-outline"></nb-icon>
  </button>
</div>
<div class="pageContent">
  <nb-card>
    <nb-card-body>
        <div class="row">
          <div class="textGroup col-12 col-lg-4">
            <p class="text_bold">作業名稱：</p>
            <span>{{detail?.jobName}}</span>
          </div>
          <div class="textGroup col-12 col-lg-4">
            <p class="text_bold">狀態：</p>
            <span>{{detail?.status?.toLowerCase() | enum:'status'}}</span>
          </div>
          <div class="textGroup col-12 col-lg-4">
            <p class="text_bold">執行頻率：</p>
            <span>{{detail?.executionFrequency?.toLowerCase() | enum:'frequency'}}</span>
          </div>
        </div>
        <div class="row">
          <div class="textGroup col-12 col-lg-4">
              <p class="text_bold">異動時間：</p>
              <span>{{detail?.modificationTime | date:dateFormat}}</span>
          </div>
        </div>
    </nb-card-body>
  </nb-card>
  <nb-card>
    <nb-card-header>
        <h2>名單紀錄</h2>
    </nb-card-header>
    <nb-card-body>
      <div>
        <div class="rightBox" *ngIf="!this?.gridDefine?.columns?.['isChecked']"><button nbButton status="primary" size="medium" (click)="setGridDefineInit()">手動更新</button></div>
        <div class="rightBox" *ngIf="this?.gridDefine?.columns?.['isChecked']">
          <button nbButton status="basic" size="medium" (click)="setGridDefineInit()">取消</button>
          <button nbButton status="primary" size="medium" (click)="submitRefresh()">確定</button>
        </div>
        <div class="tableContainer">
          <div class="selectAll" *ngIf="this?.gridDefine?.columns?.['isChecked']">
              <nb-checkbox status="info" [checked]="isAllSelected" (change)="onSelectAllChange(true)"></nb-checkbox>
          </div>
          <ng2-smart-table #ng2SmartTable [settings]="gridDefine" [source]="dataSource"></ng2-smart-table>
          <paginator [source]="dataSource" [paginator]="paginator"></paginator>
        </div>
      </div>
    </nb-card-body>
  </nb-card>
  <nb-card *ngIf="isHistoryOpen && detail?.historyGroupView">
      <nb-card-header>
          <h2>異動歷程</h2>
      </nb-card-header>
      <nb-card-body>
          <div class="historyList">
              <ng-container *ngFor="let hg of detail.historyGroupView | keyvalue; let i=index;">
                  <div class="historyItem active moreBtn" [ngClass]="isHistoryOpen[hg.key] ? 'closeSubItem' : ''" *ngIf="hg.value as history;">
                      <div class="mainItem">
                          <h4 (click)="isHistoryOpen[hg.key] = !isHistoryOpen[hg.key]">{{history.type}}</h4>
                          <button nbButton ghost status="primary" size="tiny" class="iconBtn" (click)="isHistoryOpen[hg.key] = !isHistoryOpen[hg.key]">
                              <nb-icon icon="arrow-ios-forward"></nb-icon>
                          </button>
                      </div>
                      <div class="subItem" [ngClass]="isHistoryOpen[hg.key] ? '' : 'dis_none'" *ngFor="let flow of history.flows">
                          <div>
                              <p>{{flow.time | date:dateFormat}}</p>
                              <p>{{flow.time | date:'hh:mm:ss'}}</p>
                          </div>
                          <div>
                              <p>{{flow.title}}</p>
                              <p>{{flow.detail}}</p>
                          </div>
                      </div>
                  </div>
              </ng-container>
          </div>
      </nb-card-body>
  </nb-card>
  <div class="row">
      <div class="btnGroup">
          <button nbButton status="basic" size="medium" (click)="cancel()">返回</button>
      </div>
  </div>
</div>
