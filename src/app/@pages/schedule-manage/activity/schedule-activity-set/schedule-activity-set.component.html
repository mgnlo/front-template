<div class="pageTitle">
  <h1>排程管理</h1>
</div>
<div class="pageContent">
  <nb-card>
      <nb-card-header>
          <h2>{{actionName}}排程</h2>
      </nb-card-header>
      <nb-card-body [formGroup]="validateForm">
        <div class="row">
          <basic-input class="col-12 col-lg-6" title="排程名稱" [form]="validateForm" ctlName="jobName"></basic-input>
          <dropdown class="col-12 col-lg-6" title="狀態" [form]="validateForm" ctlName="status"></dropdown>
          <div class="fieldGroup essential col-12 col-lg-6"
          [ngClass]="
          {
            'error':
            (
              (validateForm.get('daily')?.touched && validateForm.get('daily')?.invalid)||
              (validateForm.get('minute')?.touched && validateForm.get('minute')?.invalid)||
              (validateForm.get('hour')?.touched && validateForm.get('hour')?.invalid)
            )
          }">
          <radio title="排程頻率" [form]="validateForm" ctlName="executionFrequency"
                 [selectList]="{options: frequencyList, key: 'key', val: 'val'}"
                 (valueChange)="changeFrequencyType($event)"
                 [errorTextBoolen]="false"></radio>
            <div *ngIf="validateForm.get('executionFrequency').value?.toLowerCase() === 'daily'" class="multi">
              <nb-select fullWidth placeholder="時" formControlName="hour"
                         [status]="validateForm.get('hour')?.touched && validateForm.get('hour')?.invalid? 'danger' : 'basic'">
              <nb-option *ngFor="let hour of hourList" [value]="hour.key">{{ hour.val }}</nb-option>
              </nb-select>
              <span>：</span>
              <nb-select fullWidth placeholder="分" formControlName="minute"
                         [status]="validateForm.get('minute')?.touched && validateForm.get('minute')?.invalid? 'danger' : 'basic'">
              <nb-option *ngFor="let minute of minuteList" [value]="minute.key">{{ minute.val }}</nb-option>
              </nb-select>
            </div>

            <div *ngIf="validateForm.get('executionFrequency').value?.toLowerCase() === 'weekly'" class="multi">
              <nb-select  fullWidth placeholder="日" formControlName="daily"
                          [status]="validateForm.get('daily')?.touched && validateForm.get('daily')?.invalid? 'danger' : 'basic'">
              <nb-option *ngFor="let daily of weekDailyList" [value]="daily.key">{{ daily.val }}</nb-option>
              </nb-select>
              <nb-select  fullWidth placeholder="時" formControlName="hour"
                          [status]="validateForm.get('hour')?.touched && validateForm.get('hour')?.invalid? 'danger' : 'basic'">
              <nb-option *ngFor="let hour of hourList" [value]="hour.key">{{ hour.val }}</nb-option>
              </nb-select>
              <span>：</span>
              <nb-select  fullWidth placeholder="分" formControlName="minute"
                          [status]="validateForm.get('minute')?.touched && validateForm.get('minute')?.invalid? 'danger' : 'basic'">
              <nb-option *ngFor="let minute of minuteList" [value]="minute.key">{{ minute.val }}</nb-option>
              </nb-select>
            </div>

            <div *ngIf="validateForm.get('executionFrequency').value?.toLowerCase() === 'monthly'" class="multi">
              <nb-select  fullWidth placeholder="日" formControlName="daily"
                          [status]="validateForm.get('daily')?.touched && validateForm.get('daily')?.invalid? 'danger' : 'basic'">
              <nb-option *ngFor="let daily of monthDailyList" [value]="daily.key">{{ daily.val }}</nb-option>
              </nb-select>
              <span>日</span>
              <nb-select  fullWidth placeholder="時" formControlName="hour"
                          [status]="validateForm.get('hour')?.touched && validateForm.get('hour')?.invalid? 'danger' : 'basic'">
              <nb-option *ngFor="let hour of hourList" [value]="hour.key">{{ hour.val }}</nb-option>
              </nb-select>
              <span>：</span>
              <nb-select  fullWidth placeholder="分" formControlName="minute"
                          [status]="validateForm.get('minute')?.touched && validateForm.get('minute')?.invalid? 'danger' : 'basic'">
              <nb-option *ngFor="let minute of minuteList" [value]="minute.key">{{ minute.val }}</nb-option>
              </nb-select>
            </div>

            <div class="note errorText">
                <nb-icon icon="alert-triangle"></nb-icon>
                <p>此為必填欄位</p>
            </div>
          </div>
          <basic-input class="col-12 col-lg-6" title="檔案存放地方" [form]="validateForm" ctlName="filePath"></basic-input>
        </div>
      </nb-card-body>
  </nb-card>
  <nb-card>
    <nb-card-header>
        <h2>名單列表</h2>
    </nb-card-header>
    <nb-card-body>
        <div class="rightBox">
          <button nbButton status="primary" size="medium" (click)="add()">新 增</button>
        </div>
        <ng2-smart-table [settings]="gridDefine" [source]="dataSource"></ng2-smart-table>
        <paginator [source]="dataSource" [paginator]="paginator"></paginator>
    </nb-card-body>
  </nb-card>
  <div class="row">
      <div class="btnGroup">
          <button nbButton status="basic" size="medium" (click)="cancel()">取 消</button>
          <button nbButton status="primary" size="medium" (click)="submit()" [disabled]="validateForm.invalid">送 審</button>
      </div>
  </div>
</div>
