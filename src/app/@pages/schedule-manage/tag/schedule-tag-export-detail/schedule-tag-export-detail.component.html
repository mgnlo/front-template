<div class="pageTitle">
  <h1>排程紀錄</h1>
</div>
<div class="pageContent">
  <nb-card>
    <nb-card-body>
        <div class="row">
          <div class="textGroup col-12 col-lg-4">
              <p class="text_bold">標籤名稱：</p>
              <span>{{detail?.tagName}}</span>
          </div>
          <div class="textGroup col-12 col-lg-4">
              <p class="text_bold">狀態：</p>
              <span>{{detail?.status?.toLowerCase() | enum:'status'}}</span>
          </div>
          <div class="textGroup col-12 col-lg-4">
            <p class="text_bold">類型：</p>
            <span>{{detail?.tagType?.toLowerCase() | enum:'tagType'}}</span>
          </div>
        </div>
        <div class="row">
          <div class="textGroup col-12 col-lg-4">
            <p class="text_bold">所屬單位：</p>
            <span>{{detail?.department}}</span>
          </div>
          <div class="textGroup col-12 col-lg-4">
            <p class="text_bold">負責人：</p>
            <span>{{detail?.owner}}</span>
          </div>
          <div class="textGroup col-12 col-lg-4">
            <p class="text_bold">起迄時間：</p>
            <span>{{detail?.startDate | date:dateFormat}}</span>
            <span>~</span>
            <span>{{detail?.endDate | date:dateFormat}}</span>
          </div>
        </div>
        <div class="row">
          <div class="textGroup col-12 col-lg-4">
            <p class="text_bold">標籤構面：</p>
            <span>{{detail?.categoryName || detail?.categoryKey}}</span>
          </div>
          <div class="textGroup col-12 col-lg-4">
            <p class="text_bold">標籤子構面：</p>
            <span>{{detail?.tagTopicName || detail?.tagTopicKey}}</span>
          </div>
          <div class="textGroup col-12 col-lg-4">
            <p class="text_bold">異動時間：</p>
            <span>{{detail?.modificationTime | date:dateFormat}}</span>
          </div>
        </div>
        <div class="row">
          <div class="textGroup col-12 col-lg-12">
            <p class="text_bold">描述說明：</p>
            <span>{{detail?.tagDescription}}</span>
          </div>
          <div class="textGroup col-12 col-lg-4" *ngIf="detail?.tagType === 'document'">
            <p class="text_bold">名單上傳：</p>
            <a class="link-style" (click)="onDownloadFile()">{{detail?.fileName}}</a>
          </div>
        </div>
        <div *ngIf="detail?.tagType !== 'document'&&
          (detail?.conditionSettingMethod === 'field' || detail?.conditionSettingMethod === 'normal')">
          <div class="subTitle" *ngIf="detail?.conditionSettingMethod === 'field'">
              <p>條件設定</p>
          </div>
          <div class="row">
            <div class="textGroup code col-12" *ngIf="detail?.conditionSettingMethod === 'normal'">
              <p class="text_bold">條件設定：</p>
              <pre>{{detail?.conditionSettingQuery}}</pre>
            </div>
            <div class="textGroup code col-12" *ngIf="detail?.conditionSettingMethod === 'field'">
              <p class="text_bold">偵測條件：</p>
              <span>{{detail?.tagConditionSetting?.[0]?.conditionName || detail?.tagConditionSetting?.[0]?.conditionKey}}</span>
            </div>
            <!-- 灰底區塊 -->
            <div class="colorArea col-12" *ngIf="detail?.conditionSettingMethod === 'field'">
              <div class="row">
                <ng-container *ngFor="let tagCondition of detail?.tagConditionSetting">
                  <div class="textGroup gather">
                    <p>{{tagCondition?.detectionCondition?.toLowerCase() | enum:'mathSymbol'}}</p>
                    <span>{{tagCondition?.thresholdValue}}</span>
                    <nb-tag *ngIf="tagCondition?.joinValue?.toLowerCase() === 'and'" status="warning" appearance="filled" text="and"></nb-tag>
                    <nb-tag *ngIf="tagCondition?.joinValue?.toLowerCase() === 'or'" status="info" appearance="filled" text="or"></nb-tag>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
    </nb-card-body>
  </nb-card>
  <nb-card>
    <nb-card-header>
        <h2>排程紀錄</h2>
    </nb-card-header>
    <nb-card-body>
      <div>
        <ng2-smart-table [settings]="gridDefine" [source]="dataSource"></ng2-smart-table>
        <paginator [source]="dataSource" [paginator]="paginator"></paginator>
      </div>
    </nb-card-body>
  </nb-card>
  <div class="row">
      <div class="btnGroup">
          <button nbButton status="basic" size="medium" (click)="cancel()">返 回</button>
      </div>
  </div>
</div>
