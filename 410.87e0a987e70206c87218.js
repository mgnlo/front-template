(self.webpackChunkconsole_frontend=self.webpackChunkconsole_frontend||[]).push([[410],{57410:(t,i,e)=>{"use strict";e.r(i),e.d(i,{NB_MODULES:()=>zt,TagManageModule:()=>Wt});var n=e(39363),o=e(3679),a=e(2063),l=e(73749),s=e(38832),r=e(76185),d=e(86794),c=e(63423),u=e(37716);let g=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=u.Xpm({type:t,selectors:[["tag-manage"]],decls:1,vars:0,template:function(t,i){1&t&&u._UZ(0,"router-outlet")},directives:[c.lC],encapsulation:2}),t})();var h=e(36332),p=e(56037),v=e(21523),m=e(63731),y=e(32392),f=e(27091),Z=e(31508),b=e(54856),T=e(11470),x=e(15585),A=e(11004),q=e(35043),S=e(68877),w=e(79761),C=e(33256),I=e(38583),N=e(65969);function F(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"div",12),u.TgZ(1,"button",13),u.NdJ("click",function(){return u.CHM(t),u.oxw().add()}),u._uU(2,"\u65b0 \u589e"),u.qZA(),u.qZA()}}function _(t,i){if(1&t&&(u.ynx(0),u._UZ(1,"ng2-smart-table",14),u._UZ(2,"paginator",15),u.BQk()),2&t){const t=i.ngIf,e=u.oxw();u.xp6(1),u.Q6J("settings",e.gridDefine)("source",t),u.xp6(1),u.Q6J("source",t)("paginator",e.paginator)}}const k=function(t){return{options:t,key:"key",val:"val"}};let K=(()=>{class t extends y.H{constructor(t,i,e,n,a,l,s){super(t,i,e),this.router=n,this.tagManageService=a,this.activatedRoute=l,this.tableService=s,this.isSearch=!1,this.statusList=Object.entries(h.qb).map(([t,i])=>({key:t,val:i})),this.sessionKey=this.activatedRoute.snapshot.routeConfig.path,this.gridDefine={pager:{display:!0,perPage:10},columns:{tagName:{title:"\u6a19\u7c64\u540d\u7a31",type:"string",sort:!1},tagType:{title:"\u985e\u578b",type:"html",class:"text_center min_w100",valuePrepareFunction:t=>t?'<p class="text_center">'+(p.Qy[t]||"")+"</p>":"",sort:!1},department:{title:"\u6240\u5c6c\u55ae\u4f4d",type:"html",class:"text_center min_w100",valuePrepareFunction:t=>'<p class="text_center">'+(null!=t?t:"")+"</p>",sort:!1},owner:{title:"\u8ca0\u8cac\u4eba",type:"html",class:"text_center min_w100",valuePrepareFunction:t=>'<p class="text_center">'+(null!=t?t:"")+"</p>",sort:!1},tagDescription:{title:"\u8aaa\u660e",type:"html",valuePrepareFunction:t=>`<p>${null!=t?t:""}</p>`,sort:!1},during:{title:"\u6a19\u7c64\u6709\u6548\u8d77\u8fc4\u65e5",type:"html",class:"text_center min_w250",valuePrepareFunction:(t,i)=>i.startDate&&i.endDate?`<p class="text_center">${null==i?void 0:i.startDate} ~ ${null==i?void 0:i.endDate}</p>`:"",sort:!1},status:{title:"\u72c0\u614b",type:"html",class:"text_center min_w100",valuePrepareFunction:(t,i)=>`<p class="text_center">${h.qb[i.reviewStatus]||h.qb[t]||""}</p>`,sort:!1},action:{title:"\u67e5\u770b",type:"custom",class:"center",width:"3rem",valuePrepareFunction:(t,i)=>i,renderComponent:m.m,sort:!1}},hideSubHeader:!0,actions:{add:!1,edit:!1,delete:!1}},this.validateForm=new o.cw({tagName:new o.NI(""),status:new o.NI(""),startDate:new o.NI(null,v.I.dateFmt),endDate:new o.NI(null,v.I.dateFmt)},[v.I.dateRange])}ngOnInit(){this.search()}ngOnDestroy(){this.setSessionData()}setSessionData(){var t,i;const e=this.isSearch?this.validateForm.getRawValue():null!==(i=null===(t=this.storageService.getSessionVal(this.sessionKey))||void 0===t?void 0:t.filter)&&void 0!==i?i:this.validateForm.getRawValue();this.setSessionVal({page:this.paginator.nowPage,filter:e})}reset(){this.validateForm.reset({tagName:"",status:"",startDate:null,endDate:null}),this.isSearch=!0,this.paginator.nowPage=1,this.setSessionData(),this.search("reset")}search(t){if(this.isMock){this.dataSource.reset();let t=this.validateForm.getRawValue();for(const[i,e]of Object.entries(t).filter(([t,i])=>!!i))this.dataSource.addFilter({field:i,filter:void 0,search:e});return void this.dataSource.load(Z.O)}const i=this.storageService.getSessionVal(this.sessionKey);this.isSearch=!1,"search"===t&&(this.isSearch=!0),["search","reset"].includes(t)&&(this.paginator.nowPage=1);let e=this.paginator.nowPage;"search"!==t&&(null==i?void 0:i.filter)&&(e=i.page,f.l.initializeFormWithSessionData(this.validateForm,i)),"reset"!==t&&this.setSessionData();let n={apiUrl:this.tagManageService.tagFunc,nowPage:e,filters:this.validateForm.getRawValue(),errMsg:"\u6a19\u7c64\u5217\u8868\u67e5\u7121\u8cc7\u6599"};this.restDataSource=this.tableService.searchData(n)}add(){this.router.navigate(["pages","tag-manage","tag-set"])}}return t.\u0275fac=function(i){return new(i||t)(u.Y36(b.V),u.Y36(T.E),u.Y36(x.r),u.Y36(c.F0),u.Y36(A.P),u.Y36(c.gz),u.Y36(q.I))},t.\u0275cmp=u.Xpm({type:t,selectors:[["tag-list"]],features:[u.qOj],decls:27,vars:10,consts:[[1,"pageTitle"],[1,"pageContent"],[3,"formGroup"],[1,"row"],["title","\u6a19\u7c64\u540d\u7a31","ctlName","tagName",1,"col-12","col-lg-6",3,"form"],["title","\u72c0\u614b","ctlName","status","enumName","reviewStatus",1,"col-12","col-lg-6",3,"form","selectList"],[3,"form"],[1,"btnGroup"],["nbButton","","status","basic","size","medium",3,"click"],["nbButton","","status","primary","size","medium",3,"disabled","click"],["class","rightBox",4,"ngIf"],[4,"ngIf"],[1,"rightBox"],["nbButton","","status","primary","size","medium",3,"click"],[3,"settings","source"],[3,"source","paginator"]],template:function(t,i){1&t&&(u.TgZ(0,"div",0),u.TgZ(1,"h1"),u._uU(2,"\u6a19\u7c64\u7ba1\u7406"),u.qZA(),u.qZA(),u.TgZ(3,"div",1),u.TgZ(4,"nb-card"),u.TgZ(5,"nb-card-header"),u.TgZ(6,"h2"),u._uU(7,"\u67e5\u8a62\u503c\u8a2d\u5b9a"),u.qZA(),u.qZA(),u.TgZ(8,"nb-card-body",2),u.TgZ(9,"div",3),u._UZ(10,"basic-input",4),u._UZ(11,"dropdown",5),u.qZA(),u._UZ(12,"date-range",6),u.qZA(),u.qZA(),u.TgZ(13,"div",3),u.TgZ(14,"div",7),u.TgZ(15,"button",8),u.NdJ("click",function(){return i.reset()}),u._uU(16,"\u6e05 \u9664"),u.qZA(),u.TgZ(17,"button",9),u.NdJ("click",function(){return i.search("search")}),u._uU(18,"\u67e5 \u8a62"),u.qZA(),u.qZA(),u.qZA(),u._UZ(19,"hr"),u.TgZ(20,"nb-card"),u.TgZ(21,"nb-card-header"),u.TgZ(22,"h2"),u._uU(23,"\u6a19\u7c64\u5217\u8868"),u.qZA(),u.qZA(),u.TgZ(24,"nb-card-body"),u.YNc(25,F,3,0,"div",10),u.YNc(26,_,3,4,"ng-container",11),u.qZA(),u.qZA(),u.qZA()),2&t&&(u.xp6(8),u.Q6J("formGroup",i.validateForm),u.xp6(2),u.Q6J("form",i.validateForm),u.xp6(1),u.Q6J("form",i.validateForm)("selectList",u.VKq(8,k,i.statusList)),u.xp6(1),u.Q6J("form",i.validateForm),u.xp6(5),u.Q6J("disabled",i.validateForm.invalid),u.xp6(8),u.Q6J("ngIf",i.isCrud.create),u.xp6(1),u.Q6J("ngIf",i.restDataSource||i.dataSource))},directives:[s.Asz,s.ndF,s.yKW,o.JL,o.sg,S.n,w.J,C.S,s.DPz,I.O5,r.T5,N.J],styles:[""]}),t})();class D{constructor(t){Object.assign(this,t)}}class L{constructor(t){Object.assign(this,t)}}class J{constructor(t){Object.assign(this,t)}}var M=e(88567),O=e(30629),U=e(16738),Q=e(5304),E=e(45435),V=e(93342),B=e(68939),Y=e(28049),H=e(93104);const P=function(){return{width:"100%",height:"265px"}};let $=(()=>{class t{constructor(t){this.theme=t,this.seriesData=new Array,this.xAxisData=new Array,this.yAxisData=new Array,this.options={}}sortConditionDistribution(t,i,e){return t.sort((t,i)=>{const n=parseInt(e(t).replace(O.O.chinese,"")),o=parseInt(e(i).replace(O.O.chinese,""));return n<0&&o<0?o-n:n-o})}getMapKeyByValue(t,i){return i.map(i=>i[t])}ngOnInit(){const t=this.sortConditionDistribution(this.data.conditionDistribution,t=>t.distributionKey,t=>t.distributionKey);this.xAxisData=this.getMapKeyByValue("distributionKey",t);const i=this.sortConditionDistribution(this.data.conditionDistribution,t=>t.sort,t=>t.sort);this.yAxisData=this.getMapKeyByValue("distributionValue",i),this.seriesData.push({name:this.data.conditionName,type:"line",smooth:!0,data:this.yAxisData})}ngAfterViewInit(){this.themeSubscription=this.theme.getJsTheme().subscribe(t=>{var i;const e=t.variables.echarts;let n=Math.max(...this.yAxisData.filter(t=>"number"==typeof t)),o=Math.min(...this.yAxisData.filter(t=>"number"==typeof t));this.options={backgroundColor:e.bg,color:"#29A7E6",tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c}"},legend:{left:"left",data:null===(i=this.data)||void 0===i?void 0:i.conditionKey,textStyle:{color:e.textColor}},xAxis:[{type:"category",data:this.xAxisData,axisTick:{alignWithLabel:!0},axisLine:{lineStyle:{color:e.axisLineColor}},axisLabel:{textStyle:{color:e.textColor}}}],yAxis:[{type:"value",axisLine:{lineStyle:{color:e.axisLineColor}},splitLine:{lineStyle:{color:e.splitLineColor}},axisLabel:{formatter:function(t){return t<1e4?t+"\u7b46":t/1e4+"\u842c\u7b46"},textStyle:{color:e.textColor}},min:o,max:n,splitNumber:10}],grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0,height:"90%"},series:this.seriesData}})}ngOnDestroy(){this.themeSubscription&&this.themeSubscription.unsubscribe()}}return t.\u0275fac=function(i){return new(i||t)(u.Y36(s.WMF))},t.\u0275cmp=u.Xpm({type:t,selectors:[["condition-chart-line"]],inputs:{data:"data"},decls:1,vars:4,consts:[["echarts","",1,"echart",3,"options"]],template:function(t,i){1&t&&u._UZ(0,"div",0),2&t&&(u.Akn(u.DdM(3,P)),u.Q6J("options",i.options))},directives:[H.w],styles:[""]}),t})(),j=(()=>{class t{constructor(t){this.ref=t}close(){this.ref.close()}}return t.\u0275fac=function(i){return new(i||t)(u.Y36(s.X4l))},t.\u0275cmp=u.Xpm({type:t,selectors:[["condition-dialog"]],inputs:{title:"title",data:"data"},decls:19,vars:3,consts:[[1,"dialogCard","medium"],[1,"text-h-center"],[1,"noteText"],["icon","info-outline"],[1,"row"],[1,"textGroup","col-12","col-lg-12"],[1,"text_bold"],[1,"col-12","col-lg-12"],[3,"data"],[1,"btnGroup"],["nbButton","","status","basic","size","medium",3,"click"]],template:function(t,i){1&t&&(u.TgZ(0,"nb-card",0),u.TgZ(1,"nb-card-header",1),u.TgZ(2,"h2"),u._uU(3),u.qZA(),u.qZA(),u.TgZ(4,"nb-card-body"),u.TgZ(5,"div",2),u._UZ(6,"nb-icon",3),u.TgZ(7,"p"),u._uU(8,"\u6b64\u689d\u4ef6\u4eba\u6578\u7d1a\u8ddd\u5982\u4e0b\uff0c\u82e5\u6709\u591a\u91cd\u4ef6\u7d44\u5408\uff0c\u5247\u9700\u591a\u91cd\u5c0d\u7167\u4ee5\u5229\u8cbc\u5408\u6d3b\u52d5\u9810\u7b97\u8207\u4eba\u6578\u9700\u6c42\u3002"),u.qZA(),u.qZA(),u.TgZ(9,"div",4),u.TgZ(10,"div",5),u.TgZ(11,"p",6),u._uU(12),u.qZA(),u.qZA(),u.TgZ(13,"div",7),u._UZ(14,"condition-chart-line",8),u.qZA(),u.qZA(),u.qZA(),u.TgZ(15,"nb-card-footer"),u.TgZ(16,"div",9),u.TgZ(17,"button",10),u.NdJ("click",function(){return i.close()}),u._uU(18,"\u95dc \u9589"),u.qZA(),u.qZA(),u.qZA(),u.qZA()),2&t&&(u.xp6(3),u.Oqu(i.title),u.xp6(9),u.hij("",null==i.data?null:i.data.conditionName,"\u4eba\u6578\u7d1a\u8ddd"),u.xp6(2),u.Q6J("data",i.data))},directives:[s.Asz,s.ndF,s.yKW,s.fMN,$,s.XWE,s.DPz],styles:[""]}),t})();const G={conditionKey:"\u4eba\u6578",conditionName:"\u5237\u5361\u6d88\u8cbb\u91d1\u984d",conditionDistribution:[{distributionKey:"3000\u842c",distributionValue:60,sort:"3"},{distributionKey:"9000\u842c",distributionValue:50,sort:"-1"},{distributionKey:"1000\u842c",distributionValue:10,sort:"1"},{distributionKey:"2000\u842c",distributionValue:40,sort:"2"}]};var R=e(26575);const z=[{categoryKey:"category_value_1",categoryName:"\u4e3b\u69cb\u97621"},{categoryKey:"category_value_2",categoryName:"\u4e3b\u69cb\u97622"}],W={categoryKey:"category_value_1",categoryName:"\u4e3b\u69cb\u97621",tagTopic:[{tagTopicKey:"topic_value_1_1",tagTopicName:"\u5b50\u69cb\u97621"},{tagTopicKey:"topic_value_1_2",tagTopicName:"\u5b50\u69cb\u97622"}]};var X=e(32552),tt=e(7896),it=e(15114),et=e(23918),nt=e(46988);function ot(t,i){1&t&&(u.TgZ(0,"div",17),u._UZ(1,"nb-icon",18),u.TgZ(2,"p"),u._uU(3,"\u91cd\u65b0\u9078\u53d6\u6a94\u6848\u5f8c\uff0c\u5c07\u4ee5\u65b0\u7248\u4e0a\u50b3\u8cc7\u6599\u70ba\u8cbc\u6a19\u6a19\u6e96"),u.qZA(),u.qZA())}const at=function(t){return{options:t,key:"key",val:"val"}};function lt(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"div"),u.TgZ(1,"radio",19),u.NdJ("valueChange",function(i){return u.CHM(t),u.oxw().changeConditionSettingMethod(i)}),u.qZA(),u.qZA()}if(2&t){const t=u.oxw();u.xp6(1),u.Q6J("form",t.validateForm)("selectList",u.VKq(2,at,t.tagSetConditionList))}}const st=function(t){return{error:t}};function rt(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"div",20),u.TgZ(1,"label"),u._uU(2,"\u540d\u55ae\u4e0a\u50b3"),u.qZA(),u.TgZ(3,"div"),u._UZ(4,"input",21),u.TgZ(5,"input",22),u.NdJ("change",function(i){return u.CHM(t),u.oxw().onUploadFile(i)}),u.qZA(),u.TgZ(6,"button",23),u._UZ(7,"nb-icon",24),u.qZA(),u.qZA(),u.TgZ(8,"div",25),u._UZ(9,"nb-icon",26),u.TgZ(10,"p"),u._uU(11),u.qZA(),u.qZA(),u.TgZ(12,"div",27),u._UZ(13,"nb-icon",28),u.TgZ(14,"p"),u._uU(15),u.qZA(),u.qZA(),u.qZA()}if(2&t){const t=u.oxw();let i,e,n;u.Q6J("ngClass",u.VKq(5,st,null==(i=t.validateForm.get("fileName"))||null==i.errors?null:i.errors.uploadFileMsg)),u.xp6(4),u.Q6J("status",null!=(e=t.validateForm.get("fileName"))&&null!=e.errors&&e.errors.uploadFileMsg?"danger":"basic"),u.xp6(1),u.Q6J("accept",t.removeLastCharIfEquals(t.passFileArrayStr,",")),u.xp6(6),u.Oqu(null==(n=t.validateForm.get("fileName"))||null==n.errors?null:n.errors.uploadFileMsg),u.xp6(4),u.hij("\u8acb\u4e0a\u50b3",t.removeLastCharIfEquals(t.passFileArrayStr,","),"\u683c\u5f0f\u985e\u578b\u6a94\u6848")}}function dt(t,i){if(1&t&&(u.TgZ(0,"div"),u.TgZ(1,"div",4),u.TgZ(2,"div",29),u.TgZ(3,"label"),u._uU(4,"\u689d\u4ef6\u8a2d\u5b9a"),u.qZA(),u.TgZ(5,"div"),u.TgZ(6,"textarea",30),u._uU(7,"\t\t\t\t\t\t\t"),u.qZA(),u.qZA(),u.TgZ(8,"div",25),u._UZ(9,"nb-icon",26),u.TgZ(10,"p"),u._uU(11,"\u6b64\u70ba\u5fc5\u586b\u6b04\u4f4d"),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.qZA()),2&t){const t=u.oxw();let i,e;u.xp6(2),u.Q6J("ngClass",u.VKq(2,st,((null==(i=t.validateForm.get("conditionSettingQuery"))?null:i.dirty)||(null==(i=t.validateForm.get("conditionSettingQuery"))?null:i.touched))&&(null==(i=t.validateForm.get("conditionSettingQuery"))?null:i.invalid))),u.xp6(4),u.Q6J("status",(null!=(e=t.validateForm.get("conditionSettingQuery"))&&e.dirty||null!=(e=t.validateForm.get("conditionSettingQuery"))&&e.touched)&&null!=(e=t.validateForm.get("conditionSettingQuery"))&&e.invalid?"danger":"basic")}}function ct(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"input",43),u.NdJ("keyup",function(){return u.CHM(t),u.oxw(3).isInit=!1})("click",function(){return u.CHM(t),u.oxw(3).isInit=!1}),u.qZA()}if(2&t){const t=u.oxw().ngIf;u.Q6J("status",null!=t&&null!=t.errors&&t.errors.condition_valueErrMsg?"danger":"basic")}}function ut(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"input",44),u.NdJ("input",function(i){return u.CHM(t),u.oxw(3).onConditionKeyChange(i)})("blur",function(){return u.CHM(t),u.oxw(3).onBlurConditionKeyInput()}),u.qZA()}if(2&t){const t=u.oxw().ngIf,i=u.MAs(8);u.Q6J("nbAutocomplete",i)("status",null!=t&&null!=t.errors&&t.errors.condition_valueErrMsg?"danger":"basic")}}function gt(t,i){if(1&t&&(u.TgZ(0,"nb-option",45),u._uU(1),u.qZA()),2&t){const t=i.$implicit;u.Q6J("value",t),u.xp6(1),u.hij(" ",t.val," ")}}function ht(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"div",4),u.TgZ(1,"div",34),u.TgZ(2,"label"),u._uU(3,"\u5075\u6e2c\u689d\u4ef6"),u.qZA(),u.TgZ(4,"div"),u.YNc(5,ct,1,1,"input",35),u.YNc(6,ut,1,2,"input",36),u.TgZ(7,"nb-autocomplete",37,38),u.NdJ("selectedChange",function(i){return u.CHM(t),u.oxw(2).onConditionKeySelectChange(i)}),u.YNc(9,gt,2,2,"nb-option",39),u.qZA(),u.qZA(),u.TgZ(10,"div",25),u._UZ(11,"nb-icon",26),u.TgZ(12,"p"),u._uU(13),u.qZA(),u.qZA(),u.TgZ(14,"div",40),u.TgZ(15,"button",41),u.NdJ("click",function(){return u.CHM(t),u.oxw(2).conditionDialog()}),u._UZ(16,"nb-icon",42),u._uU(17,"\u689d\u4ef6\u5206\u4f48\u7d1a\u8ddd "),u.qZA(),u.qZA(),u.qZA(),u.qZA()}if(2&t){const t=i.ngIf,e=u.oxw(2);u.xp6(1),u.Q6J("ngClass",u.VKq(7,st,null==t||null==t.errors?null:t.errors.condition_valueErrMsg)),u.xp6(4),u.Q6J("ngIf",e.tagId&&e.isInit),u.xp6(1),u.Q6J("ngIf",!e.tagId||!e.isInit),u.xp6(3),u.Q6J("ngForOf",e.filterConditionKeyList),u.xp6(4),u.Oqu(null==t||null==t.errors?null:t.errors.condition_valueErrMsg),u.xp6(2),u.Q6J("status",null!=e.conditionDialogData&&e.conditionDialogData.conditionKey?"control":"basic")("disabled",!(null!=e.conditionDialogData&&e.conditionDialogData.conditionKey))}}function pt(t,i){1&t&&u._UZ(0,"div",55)}function vt(t,i){if(1&t&&u._UZ(0,"radio",56),2&t){const t=u.oxw().index,i=u.oxw(2);u.MGl("ctlName","joinValue_",i.getConditionId(t),""),u.Q6J("form",i.getFormGroupInFormArray("tagConditionSetting",t))("selectList",u.VKq(3,at,i.joinValueList))}}function mt(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"button",57),u.NdJ("click",function(){u.CHM(t);const i=u.oxw().index;return u.oxw(2).changeConditionsBtn("add",i)}),u._UZ(1,"nb-icon",58),u.qZA()}if(2&t){const t=u.oxw(3);let i;u.Q6J("disabled",null==t.validateForm||null==(i=t.validateForm.get("tagConditionSetting"))?null:i.invalid)}}function yt(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"button",59),u.NdJ("click",function(){u.CHM(t);const i=u.oxw().index;return u.oxw(2).changeConditionsBtn("remove",i)}),u._UZ(1,"nb-icon",60),u.qZA()}}function ft(t,i){if(1&t&&(u.TgZ(0,"div",46),u.TgZ(1,"div",47),u._UZ(2,"dropdown",48),u._UZ(3,"basic-input",49),u.YNc(4,pt,1,0,"div",50),u.YNc(5,vt,1,5,"radio",51),u.TgZ(6,"div",52),u.YNc(7,mt,2,1,"button",53),u.YNc(8,yt,2,0,"button",54),u.qZA(),u.qZA(),u.qZA()),2&t){const t=i.index,e=i.first,n=i.last,o=u.oxw(2);u.xp6(1),u.s9C("formGroupName",t),u.xp6(1),u.MGl("ctlName","detectionCondition_",o.getConditionId(t),""),u.Q6J("form",o.getFormGroupInFormArray("tagConditionSetting",t))("selectList",u.VKq(10,at,o.mathSymbolList)),u.xp6(1),u.MGl("ctlName","thresholdValue_",o.getConditionId(t),""),u.Q6J("form",o.getFormGroupInFormArray("tagConditionSetting",t)),u.xp6(1),u.Q6J("ngIf",n),u.xp6(1),u.Q6J("ngIf",!n),u.xp6(2),u.Q6J("ngIf",n),u.xp6(1),u.Q6J("ngIf",!e||!n)}}function Zt(t,i){if(1&t&&(u.TgZ(0,"div"),u.TgZ(1,"div",31),u.TgZ(2,"p"),u._uU(3,"\u689d\u4ef6\u8a2d\u5b9a"),u.qZA(),u.qZA(),u.YNc(4,ht,18,9,"div",32),u.YNc(5,ft,9,12,"div",33),u.ALo(6,"keyvalue"),u.qZA()),2&t){const t=u.oxw();u.xp6(4),u.Q6J("ngIf",t.validateForm.get("conditionKey")),u.xp6(1),u.Q6J("ngForOf",u.lcZ(6,2,t.conditions.controls))}}function bt(t,i){if(1&t&&(u.TgZ(0,"div",73),u.TgZ(1,"div"),u.TgZ(2,"p"),u._uU(3),u.ALo(4,"date"),u.qZA(),u.TgZ(5,"p"),u._uU(6),u.ALo(7,"date"),u.qZA(),u.qZA(),u.TgZ(8,"div"),u.TgZ(9,"p"),u._uU(10),u.qZA(),u.TgZ(11,"p"),u._uU(12),u.qZA(),u.qZA(),u.qZA()),2&t){const t=i.$implicit,e=u.oxw(2).$implicit,n=u.oxw(3);u.Q6J("ngClass",n.isHistoryOpen[e.key]?"":"dis_none"),u.xp6(3),u.Oqu(u.xi3(4,5,t.time,n.dateFormat)),u.xp6(3),u.Oqu(u.xi3(7,8,t.time,"hh:mm:ss")),u.xp6(4),u.Oqu(t.title),u.xp6(2),u.Oqu(t.detail)}}function Tt(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"div",67),u.TgZ(1,"div",68),u.TgZ(2,"h4",69),u.NdJ("click",function(){u.CHM(t);const i=u.oxw().$implicit,e=u.oxw(3);return e.isHistoryOpen[i.key]=!e.isHistoryOpen[i.key]}),u._uU(3),u.qZA(),u.TgZ(4,"button",70),u.NdJ("click",function(){u.CHM(t);const i=u.oxw().$implicit,e=u.oxw(3);return e.isHistoryOpen[i.key]=!e.isHistoryOpen[i.key]}),u._UZ(5,"nb-icon",71),u.qZA(),u.qZA(),u.YNc(6,bt,13,11,"div",72),u.qZA()}if(2&t){const t=i.ngIf,e=u.oxw().$implicit,n=u.oxw(3);u.Q6J("ngClass",n.isHistoryOpen[e.key]?"closeSubItem":""),u.xp6(3),u.Oqu(t.type),u.xp6(3),u.Q6J("ngForOf",t.flows)}}function xt(t,i){if(1&t&&(u.ynx(0),u.YNc(1,Tt,7,3,"div",66),u.BQk()),2&t){const t=i.$implicit;u.xp6(1),u.Q6J("ngIf",null==t?null:t.value)}}function At(t,i){if(1&t&&(u.TgZ(0,"div",64),u.YNc(1,xt,2,1,"ng-container",65),u.ALo(2,"keyvalue"),u.qZA()),2&t){const t=u.oxw(2);u.xp6(1),u.Q6J("ngForOf",u.lcZ(2,1,t.detail.historyGroupView))}}function qt(t,i){if(1&t&&(u.TgZ(0,"nb-tab",74),u._UZ(1,"ng2-smart-table",75),u._UZ(2,"paginator",76),u.qZA()),2&t){const t=u.oxw(2);u.xp6(1),u.Q6J("settings",t.gridDefine)("source",t.restDataSource),u.xp6(1),u.Q6J("source",t.restDataSource)("paginator",t.paginator)}}function St(t,i){if(1&t&&(u.TgZ(0,"nb-card"),u.TgZ(1,"nb-card-body"),u.TgZ(2,"nb-tabset"),u.TgZ(3,"nb-tab",61),u.YNc(4,At,3,3,"div",62),u.qZA(),u.YNc(5,qt,3,4,"nb-tab",63),u.qZA(),u.qZA(),u.qZA()),2&t){const t=u.oxw();u.xp6(4),u.Q6J("ngIf",null==t.detail?null:t.detail.historyGroupView),u.xp6(1),u.Q6J("ngIf",!!t.restDataSource)}}let wt=(()=>{class t extends y.H{constructor(t,i,e,n,a,l,s,r,d,c){var u,g;super(t,i,e),this.router=n,this.activatedRoute=a,this.tagManageService=l,this.fileService=s,this.loadingService=r,this.dialogService=d,this.tableService=c,this.params=[],this.maxSizeInMB=5,this.passFileArrayStr=".csv,,,,",this.passFileArray=["csv"],this.isHistoryOpen={},this.selectedConditionKey="",this.selectedConditionVal="",this.isInit=!1,this.changeConditionType=!1,this.tagStatusList=[h.qb.enabled,h.qb.disabled],this.statusList=Object.entries(h.qb).filter(([t,i])=>this.tagStatusList.includes(i)).map(([t,i])=>({key:t,val:i})),this.beforeCategoryVal="",this.beforeSubCategoryVal="",this.categoryList=new Array,this.subCategoryList=new Array,this.tagMathSymbolList=[h.P3.$gt,h.P3.$lt,h.P3.$eq],this.mathSymbolList=Object.entries(h.P3).filter(([t,i])=>this.tagMathSymbolList.includes(i)).map(([t,i])=>({key:t,val:i})),this.tagTypeList=Object.entries(p.Qy).map(([t,i])=>({key:t,val:i})),this.tagSetConditionList=Object.entries(p.ZN).map(([t,i])=>({key:t,val:i})),this.conditionKeyList=new Array,this.filterConditionKeyList=new Array,this.joinValueList=Object.entries(p.W2).map(([t,i])=>({key:t,val:i})),this.gridDefine={pager:{display:!0,perPage:10},columns:{activityName:{title:"\u6d3b\u52d5\u540d\u7a31",type:"string",sort:!1},activityDescription:{title:"\u6d3b\u52d5\u8aaa\u660e",type:"html",sort:!1,valuePrepareFunction:t=>`<p>${null!=t?t:""}</p>`},department:{title:"\u6240\u5c6c\u55ae\u4f4d",type:"html",class:"text_center",valuePrepareFunction:(t,i)=>t?'<p class="text_center">'+(null!=t?t:"")+"</p>":"",sort:!1},owner:{title:"\u8ca0\u8cac\u4eba",type:"html",class:"text_center",valuePrepareFunction:(t,i)=>t?'<p class="text_center">'+(null!=t?t:"")+"</p>":"",sort:!1},status:{title:"\u72c0\u614b",type:"html",class:"text_center",valuePrepareFunction:(t,i)=>`<p class="text_center">${h.qb[i.reviewStatus]||h.qb[t]||""}</p>`,sort:!1},during:{title:"\u8d77\u8fc4\u6642\u9593",type:"html",class:"text_center",valuePrepareFunction:(t,i)=>i.startDate&&i.endDate?`<p class="text_center">${null==i?void 0:i.startDate} ~ ${null==i?void 0:i.endDate}</p>`:"",sort:!1}},hideSubHeader:!0,actions:{add:!1,edit:!1,delete:!1}},this.existsInConditionKeyList=t=>{var i,e,n;let o="";return o=(null==t?void 0:t.value)instanceof Object&&"key"in(null==t?void 0:t.value)&&"val"in(null==t?void 0:t.value)?null===(e=null===(i=null==t?void 0:t.value)||void 0===i?void 0:i.val)||void 0===e?void 0:e.toLowerCase():null===(n=null==t?void 0:t.value)||void 0===n?void 0:n.toLowerCase(),(t.dirty||t.touched||t.valueChanges)&&this.conditionKeyList&&!f.l.isBlank(o)&&0===this.conditionKeyList.filter(t=>{var i;return(null===(i=null==t?void 0:t.val)||void 0===i?void 0:i.toLowerCase())===o}).length?{condition_valueErrMsg:"\u4e0d\u5b58\u5728\u5075\u6e2c\u689d\u4ef6\u6e05\u55ae\u4e2d"}:(t.dirty||t.touched)&&f.l.isBlank(o)?{condition_valueErrMsg:"\u4e0d\u53ef\u70ba\u7a7a"}:null},this.validateForm=new o.cw({tagName:new o.NI(null,[o.kI.required,v.I.blank]),status:new o.NI("enabled",o.kI.required),tagType:new o.NI("normal",o.kI.required),conditionSettingMethod:new o.NI("field",o.kI.required),fileName:new o.NI(null,[o.kI.required,v.I.blank]),startDate:new o.NI(new Date,[v.I.dateFmt,o.kI.required]),endDate:new o.NI(U(new Date).add(3,"months").toDate(),[v.I.dateFmt,o.kI.required]),categoryKey:new o.NI(null,o.kI.required),tagTopicKey:new o.NI({value:null,disabled:!0},o.kI.required),tagDescription:new o.NI(null),conditionKey:new o.NI({value:null,disabled:!0},[o.kI.required,this.existsInConditionKeyList]),conditionSettingQuery:new o.NI(null,[o.kI.required,v.I.blank]),tagConditionSetting:new o.Oe([])},[v.I.dateRange]),this.params=this.activatedRoute.snapshot.params,this.tagId=this.params.tagId,this.changeRouteName=null!==(g=null===(u=this.params.changeRoute)||void 0===u?void 0:u.toLocaleLowerCase())&&void 0!==g?g:"",this.actionName=f.l.getActionName(this.changeRouteName)}get conditions(){return this.validateForm.get("tagConditionSetting")}ngOnInit(){if(this.tagId){if(this.loadingService.open(),this.isMock){let t=Z.O.find(t=>t.tagId===this.tagId);this.setData(t),this.loadingService.close();const i=this.validateForm.getRawValue();return this.changeTagType(i.tagType),this.changeConditionSettingMethod(i.conditionSettingMethod),void this.dataSource.load(R.w)}this.tagManageService.getTagSettingRow(this.tagId).pipe((0,Q.K)(t=>{throw this.dialogService.alertAndBackToList(!1,"\u67e5\u7121\u8a72\u7b46\u8cc7\u6599\uff0c\u5c07\u70ba\u60a8\u5c0e\u56de\u6a19\u7c64\u5217\u8868",["pages","tag-manage","tag-list"]),new Error(t.message)}),(0,E.h)(t=>t.code===M.$.SUCCESS),(0,V.b)(t=>{var i;this.detail=JSON.parse(JSON.stringify(t.result)),console.info("this.detail",this.detail);const e=f.l.getHistoryProcessData("tagReviewHistoryAud",t.result);this.setData(this.detail),e&&"edit"===this.changeRouteName&&(this.isHistoryOpen=e.isHistoryOpen,this.detail.historyGroupView=null===(i=e.detail)||void 0===i?void 0:i.historyGroupView),this.changeTagType(this.detail.tagType),this.changeConditionSettingMethod(this.detail.conditionSettingMethod),this.getTagCategoryList()}),(0,B.x)(()=>{this.loadingService.close()})).subscribe(),this.restDataSource=this.tableService.searchData({apiUrl:`${this.tagManageService.tagFunc}${this.tagId}/activity-setting`,nowPage:this.paginator.nowPage,errMsg:"\u6a19\u7c64\u4f7f\u7528\u7bc4\u570d\u67e5\u7121\u8cc7\u6599"})}else{this.getTagCategoryList();const t=this.validateForm.getRawValue();this.changeTagType(t.tagType),this.changeConditionSettingMethod(t.conditionSettingMethod),this.getEndDate(t.conditionSettingMethod)}}ngDoCheck(){var t,i,e,n,o,a,l,s,r;this.validateForm.get("categoryKey").valueChanges.pipe((0,Y.P)()).subscribe(()=>{this.isInit=!0});const d=null===(t=this.validateForm.get("categoryKey"))||void 0===t?void 0:t.value;if(f.l.isNotBlank(d)&&d!=this.beforeCategoryVal){if(this.beforeCategoryVal=d,this.getTagSubCategoryList(d),f.l.isBlank(null===(i=this.validateForm.get("tagTopicKey"))||void 0===i?void 0:i.value))return;null===(n=null===(e=this.validateForm)||void 0===e?void 0:e.get("tagTopicKey"))||void 0===n||n.patchValue(""),null===(a=null===(o=this.validateForm)||void 0===o?void 0:o.get("tagTopicKey"))||void 0===a||a.setErrors({tagTopicKeyErrMsg:"\u8acb\u91cd\u65b0\u9078\u64c7"})}const c=null===(l=this.validateForm.get("tagTopicKey"))||void 0===l?void 0:l.value;f.l.isNotBlank(d)&&f.l.isNotBlank(c)&&c!=this.beforeSubCategoryVal&&"field"===(null===(s=this.validateForm.get("conditionSettingMethod"))||void 0===s?void 0:s.value)&&(this.beforeSubCategoryVal=c,this.changeConditionType&&this.getConditionKeyList(d,c),f.l.isBlank(null===(r=this.validateForm.get("conditionKey"))||void 0===r?void 0:r.value))}getEndDate(t){var i,e;if("field"===t)null===(i=this.validateForm.get("endDate"))||void 0===i||i.patchValue(new Date("9999-12-31"));else{const t=new I.uU("en-US"),i=new Date,n=t.transform(i.setDate(i.getDate()+30),"yyyy-MM-dd");null===(e=this.validateForm.get("endDate"))||void 0===e||e.patchValue(new Date(n))}}getTagCategoryList(){this.categoryList=new Array,this.isMock?z.forEach(t=>{this.categoryList.push({key:t.categoryKey,val:t.categoryName})}):this.tagManageService.getTagCategoryListOption().pipe((0,Q.K)(t=>{var i,e;throw this.dialogService.alertAndBackToList(!1,"\u67e5\u8a62\u6a19\u7c64\u69cb\u9762\u5931\u6557"),null===(e=null===(i=this.validateForm)||void 0===i?void 0:i.get("categoryKey"))||void 0===e||e.setErrors({categoryKeyErrMsg:t.message?t.message:"\u67e5\u8a62\u6a19\u7c64\u69cb\u9762\u5931\u6557"}),new Error(t.message)}),(0,E.h)(t=>t.code===M.$.SUCCESS),(0,V.b)(t=>{var i,e,n,o;const a=JSON.parse(JSON.stringify(t.result));return a&&0!==Object.keys(a).length?(this.categoryList=Object.entries(a).map(([t,i])=>({key:t,val:i})),this.tagId&&!this.categoryList.some(t=>{var i;return t.key===(null===(i=this.detail)||void 0===i?void 0:i.categoryKey)})?(this.dialogService.alertAndBackToList(!1,"\u67e5\u7121\u6a19\u7c64\u69cb\u9762"),void(null===(o=null===(n=this.validateForm)||void 0===n?void 0:n.get("categoryKey"))||void 0===o||o.setErrors({categoryKeyErrMsg:"\u67e5\u7121\u6a19\u7c64\u69cb\u9762"}))):void 0):(this.dialogService.alertAndBackToList(!1,"\u67e5\u7121\u6a19\u7c64\u69cb\u9762"),void(null===(e=null===(i=this.validateForm)||void 0===i?void 0:i.get("categoryKey"))||void 0===e||e.setErrors({categoryKeyErrMsg:"\u67e5\u7121\u6a19\u7c64\u69cb\u9762"})))})).subscribe()}getTagSubCategoryList(t){this.subCategoryList=new Array,f.l.isBlank(t)||(this.validateForm.get("tagTopicKey").enable(),this.isMock?W.tagTopic.forEach(t=>{this.subCategoryList.push({key:t.tagTopicKey,val:t.tagTopicName})}):this.tagManageService.getTagSubCategoryListOption(t).pipe((0,Q.K)(t=>{var i,e;throw this.dialogService.alertAndBackToList(!1,"\u67e5\u8a62\u5b50\u6a19\u7c64\u69cb\u9762\u5931\u6557"),null===(e=null===(i=this.validateForm)||void 0===i?void 0:i.get("tagTopicKey"))||void 0===e||e.setErrors({tagTopicKeyErrMsg:t.message?t.message:"\u67e5\u8a62\u5b50\u6a19\u7c64\u69cb\u9762\u5931\u6557"}),new Error(t.message)}),(0,E.h)(t=>t.code===M.$.SUCCESS),(0,V.b)(t=>{var i,e,n,o;const a=JSON.parse(JSON.stringify(t.result));return a&&0!==Object.keys(a).length?(this.subCategoryList=Object.entries(a).map(([t,i])=>({key:t,val:i})),this.tagId&&f.l.isNotBlank(this.detail.tagTopicKey)&&!this.subCategoryList.some(t=>{var i;return t.key===(null===(i=this.validateForm.get("tagTopicKey"))||void 0===i?void 0:i.value)})?(this.dialogService.alertAndBackToList(!1,"\u67e5\u7121\u5b50\u6a19\u7c64\u69cb\u9762"),void(null===(o=null===(n=this.validateForm)||void 0===n?void 0:n.get("tagTopicKey"))||void 0===o||o.setErrors({tagTopicKeyErrMsg:"\u67e5\u7121\u5b50\u6a19\u7c64\u69cb\u9762"}))):void 0):(this.detail.tagTopicKey=null,this.dialogService.alertAndBackToList(!1,"\u67e5\u7121\u5b50\u6a19\u7c64\u69cb\u9762"),void(null===(e=null===(i=this.validateForm)||void 0===i?void 0:i.get("tagTopicKey"))||void 0===e||e.setErrors({tagTopicKeyErrMsg:"\u67e5\u7121\u5b50\u6a19\u7c64\u69cb\u9762"})))})).subscribe())}changeTagType(t){var i,e,n,a,l,s;switch(null===(e=null===(i=this.validateForm)||void 0===i?void 0:i.get("fileName"))||void 0===e||e.patchValue(""),this.removeFieldIfExists("fileName"),this.removeFieldIfExists("conditionSettingMethod"),this.removeFieldIfExists("conditionSettingQuery"),null==t?void 0:t.toLocaleLowerCase()){case"normal":this.addFieldIfNotExists("conditionSettingMethod","normal",o.kI.required),this.addFieldIfNotExists("conditionSettingQuery",null===(n=this.detail)||void 0===n?void 0:n.conditionSettingQuery,[o.kI.required,v.I.blank]),null===(a=this.validateForm)||void 0===a||a.patchValue({tagType:"normal"});break;case"document":this.addFieldIfNotExists("fileName",null,o.kI.required),this.validateForm.get("fileName").patchValue(null===(l=this.detail)||void 0===l?void 0:l.fileName),null===(s=this.validateForm)||void 0===s||s.patchValue({tagType:"document"})}}changeConditionSettingMethod(t){var i,e,n,a,l,s,r,d,c,u,g,h;switch(this.changeConditionType=!1,this.removeFieldIfExists("conditionKey"),this.removeFieldIfExists("tagConditionSetting"),this.removeFieldIfExists("conditionSettingQuery"),null==t?void 0:t.toLocaleLowerCase()){case"normal":this.addFieldIfNotExists("conditionSettingQuery",null===(i=this.detail)||void 0===i?void 0:i.conditionSettingQuery,[o.kI.required,v.I.blank]),null===(e=this.validateForm)||void 0===e||e.patchValue({conditionSettingMethod:"normal"});break;case"field":this.validateForm.contains("tagConditionSetting")||this.validateForm.addControl("tagConditionSetting",new o.Oe([])),this.addFieldIfNotExists("conditionKey",null,[o.kI.required,this.existsInConditionKeyList]),this.createConditionControl(null===(n=this.detail)||void 0===n?void 0:n.tagConditionSetting),(null===(a=this.detail)||void 0===a?void 0:a.tagConditionSetting)&&0!==(null===(s=null===(l=this.detail)||void 0===l?void 0:l.tagConditionSetting)||void 0===s?void 0:s.length)||0===(null===(d=null===(r=this.conditions)||void 0===r?void 0:r.getRawValue())||void 0===d?void 0:d.length)&&this.conditions.push(new o.cw({id:new o.NI(0),detectionCondition_0:new o.NI(null,o.kI.required),thresholdValue_0:new o.NI(null,[o.kI.required,o.kI.pattern(O.O.isNumeric)])})),null===(c=this.validateForm)||void 0===c||c.patchValue({conditionSettingMethod:"field"});const t=null===(u=this.validateForm.get("categoryKey"))||void 0===u?void 0:u.value,h=null===(g=this.validateForm.get("tagTopicKey"))||void 0===g?void 0:g.value;this.getConditionKeyList(t,h)}this.tagId||this.getEndDate(t),setTimeout(()=>{this.changeConditionType=!0},0),null===(h=this.conditions)||void 0===h||h.updateValueAndValidity()}addFieldIfNotExists(t,i,e){this.validateForm.contains(t)||this.validateForm.addControl(t,new o.NI(i,e))}removeFieldIfExists(t){this.validateForm.contains(t)&&this.validateForm.removeControl(t)}getConditionKeyList(t,i){if(this.conditionKeyList=new Array,this.filterConditionKeyList=new Array,!f.l.isBlank(t)&&!f.l.isBlank(i)){if(this.validateForm.get("conditionKey").enable(),this.isMock)return X.B.forEach(t=>this.conditionKeyList.push({key:t.conditionKey,val:t.conditionName})),void(this.filterConditionKeyList=[...this.conditionKeyList]);this.tagManageService.getTagFilterConditionListOption(new L({categoryKey:t,tagTopicKey:i})).pipe((0,Q.K)(t=>{var i,e;throw this.dialogService.alertAndBackToList(!1,"\u67e5\u8a62\u5075\u6e2c\u689d\u4ef6\u5931\u6557"),null===(e=null===(i=this.validateForm)||void 0===i?void 0:i.get("conditionKey"))||void 0===e||e.setErrors({condition_valueErrMsg:t.message?t.message:"\u67e5\u8a62\u5075\u6e2c\u689d\u4ef6\u5931\u6557"}),new Error(t.message)}),(0,E.h)(t=>t.code===M.$.SUCCESS),(0,V.b)(t=>{var i,e;const n=JSON.parse(JSON.stringify(t.result));if(!n||0===Object.keys(n).length)return this.dialogService.alertAndBackToList(!1,"\u67e5\u7121\u5075\u6e2c\u689d\u4ef6"),void(null===(e=null===(i=this.validateForm)||void 0===i?void 0:i.get("conditionKey"))||void 0===e||e.setErrors({condition_valueErrMsg:"\u67e5\u7121\u5075\u6e2c\u689d\u4ef6"}));if(this.conditionKeyList=Object.entries(n).map(([t,i])=>({key:t,val:i})),this.filterConditionKeyList=[...this.conditionKeyList],this.tagId){const t=this.conditionKeyList.find(t=>{var i,e,n;return t.key==(null===(n=null===(e=null===(i=this.detail)||void 0===i?void 0:i.tagConditionSetting)||void 0===e?void 0:e[0])||void 0===n?void 0:n.conditionKey)});this.selectedConditionKey=null==t?void 0:t.key,this.selectedConditionVal=null==t?void 0:t.val,this.validateForm.get("conditionKey").patchValue(null==t?void 0:t.val),this.conditionKeyFilter(null==t?void 0:t.val),this.getTagConditionalDistribution()}})).subscribe()}}onBlurConditionKeyInput(){var t,i,e,n,o;(null===(t=this.validateForm.get("conditionKey"))||void 0===t?void 0:t.hasError("condition_valueErrMsg"))||(0!==(null===(i=this.conditionKeyList)||void 0===i?void 0:i.length)?!f.l.isBlank(this.selectedConditionKey)||this.tagId?null===(o=this.validateForm.get("conditionKey"))||void 0===o||o.setErrors(null):null===(n=this.validateForm.get("conditionKey"))||void 0===n||n.setErrors({condition_valueErrMsg:"\u8acb\u9ede\u9078\u4e00\u7b46"}):null===(e=this.validateForm.get("conditionKey"))||void 0===e||e.setErrors({condition_valueErrMsg:"\u67e5\u7121\u5075\u6e2c\u689d\u4ef6"}))}onConditionKeyChange(t){var i,e;this.selectedConditionKey="",this.conditionDialogData=void 0,this.conditionKeyFilter(t.target.value),(null===(i=this.validateForm.get("conditionKey"))||void 0===i?void 0:i.hasError("condition_valueErrMsg"))||f.l.isBlank(this.selectedConditionKey)&&(null===(e=this.validateForm.get("conditionKey"))||void 0===e||e.setErrors({condition_valueErrMsg:"\u8acb\u9ede\u9078\u4e00\u7b46"}))}onConditionKeySelectChange(t){f.l.isBlank(t.key)||f.l.isBlank(t.val)||(this.selectedConditionKey=t.key,this.selectedConditionVal=t.val,this.getTagConditionalDistribution(),this.conditionKeyFilter(this.selectedConditionVal),this.validateForm.get("conditionKey").setValue(this.selectedConditionVal))}conditionKeyFilter(t){const i=null==t?void 0:t.toLowerCase();this.filterConditionKeyList=new Array,this.filterConditionKeyList=f.l.isBlank(i)?[...this.conditionKeyList]:this.conditionKeyList.filter(t=>{var e,n;return null===(n=null===(e=t.val)||void 0===e?void 0:e.toLowerCase())||void 0===n?void 0:n.includes(i)})}getTagConditionalDistribution(){const t=this.selectedConditionKey;this.isMock?this.conditionDialogData=G:t?this.tagManageService.getTagConditionalDistribution(t).pipe((0,Q.K)(t=>{throw this.dialogService.alertAndBackToList(!1,"\u53d6\u5f97\u5716\u8868\u8cc7\u6599\u5931\u6557"),new Error(t.message)}),(0,E.h)(t=>t.code===M.$.SUCCESS),(0,V.b)(t=>{this.conditionDialogData=JSON.parse(JSON.stringify(t.result))})).subscribe():this.conditionDialogData=void 0}changeConditionsBtn(t,i){var e;if("add"===t){for(;this.conditions.controls.filter(t=>t.value.id===i).length>0;)i+=1;this.conditions.push(new o.cw({id:new o.NI(i),["detectionCondition_"+i]:new o.NI(null,o.kI.required),["thresholdValue_"+i]:new o.NI(null,o.kI.required)}));for(let t=0;t<this.conditions.length-1;t++)3===Object.keys(null===(e=this.conditions.controls[t])||void 0===e?void 0:e.value).length&&this.setConditions("add","joinValue_",this.conditions.controls[t].get("id").value,t)}else this.conditions.removeAt(i)}setConditions(t,i,e,n){let a=this.conditions.at(n);"add"===t?a.setControl(`${i+e}`,new o.NI(null,o.kI.required)):a.removeControl(`${i}`)}createConditionControl(t){null==t||t.forEach((t,i)=>{this.conditions.push(new o.cw(t.joinValue?{id:new o.NI(i),["detectionCondition_"+i]:new o.NI(t.detectionCondition,o.kI.required),["thresholdValue_"+i]:new o.NI(+t.thresholdValue,[o.kI.required,o.kI.pattern(O.O.isNumeric)]),["joinValue_"+i]:new o.NI(t.joinValue,o.kI.required)}:{id:new o.NI(i),["detectionCondition_"+i]:new o.NI(t.detectionCondition,o.kI.required),["thresholdValue_"+i]:new o.NI(+t.thresholdValue,[o.kI.required,o.kI.pattern(O.O.isNumeric)])}))})}onUploadFile(t){var i,e,n,o,a,l,s,r,d,c;const u=t.target.files[0],g=this.fileValidator(u);if(null!==g)return null===(e=null===(i=this.validateForm)||void 0===i?void 0:i.get("fileName"))||void 0===e||e.setErrors(g),void(null===(o=null===(n=this.validateForm)||void 0===n?void 0:n.get("fileName"))||void 0===o||o.patchValue(""));null===(l=null===(a=this.validateForm)||void 0===a?void 0:a.get("fileName"))||void 0===l||l.patchValue(null==u?void 0:u.name),this.uploadFileName=f.l.getFileNameWithoutExtension(null==u?void 0:u.name),this.uploadType=(null===(r=null===(s=null==u?void 0:u.type)||void 0===s?void 0:s.split("/"))||void 0===r?void 0:r[1])?null===(c=null===(d=null==u?void 0:u.type)||void 0===d?void 0:d.split("/"))||void 0===c?void 0:c[1]:f.l.getFileExtension(null==u?void 0:u.name);let h=new FormData;h.append("fileData",u),this.loadingService.open(),this.fileService.uploadFileService("tag",h).pipe((0,Q.K)(t=>{var i,e;throw this.dialogService.alertAndBackToList(!1,"\u6a94\u6848\u4e0a\u50b3\u5931\u6557"),null===(e=null===(i=this.validateForm)||void 0===i?void 0:i.get("fileName"))||void 0===e||e.setErrors({uploadFileMsg:t.message?t.message:"\u6a94\u6848\u4e0a\u50b3\u5931\u6557"}),new Error(t.message)}),(0,E.h)(t=>t.code===M.$.SUCCESS),(0,V.b)(t=>{var i,e,n,o;const a=JSON.parse(JSON.stringify(t.result)).fileDataId;f.l.isBlank(a)?null===(e=null===(i=this.validateForm)||void 0===i?void 0:i.get("fileName"))||void 0===e||e.setErrors({uploadFileMsg:"\u6a94\u6848\u4e0a\u50b3\u5931\u6557(\u8b58\u5225\u78bc\u70ba\u7a7a)"}):(this.fileData=a,null===(o=null===(n=this.validateForm)||void 0===n?void 0:n.get("fileName"))||void 0===o||o.setErrors(null))}),(0,B.x)(()=>{this.loadingService.close()})).subscribe()}fileValidator(t){var i;if(!t)return{uploadFileMsg:"\u672a\u9078\u64c7\u6a94\u6848"};if(t.size/1048576>this.maxSizeInMB)return{uploadFileMsg:"\u6a94\u6848\u5927\u5c0f\u8d85\u904e5MB"};const e=null===(i=t.name.split(".").pop())||void 0===i?void 0:i.toLowerCase();return this.passFileArray.includes(e)?null:{uploadFileMsg:"\u6a94\u6848\u683c\u5f0f\u932f\u8aa4"}}removeLastCharIfEquals(t,i){return f.l.removeLastCharIfEquals(t,i)}getFormGroupInFormArray(t,i){return f.l.getFormGroupInFormArray(this.validateForm,t,i)}getConditionId(t){return f.l.getFormGroupInFormArray(this.validateForm,"tagConditionSetting",t).get("id").value}conditionDialog(){this.dialogService.open(j,{title:"\u689d\u4ef6\u5206\u4f48\u7d1a\u8ddd",data:this.conditionDialogData})}cancel(){this.router.navigate(["pages","tag-manage","tag-list"])}submit(){const t=this.validateForm.valid,i=this.getRequestData();t&&i?this.saveTagSetting(i):this.dialogService.alertAndBackToList(!1,`${this.actionName}\u9a57\u8b49\u5931\u6557`,["pages","tag-manage","tag-set",...this.tagId?[this.changeRouteName,this.tagId]:[]])}saveTagSetting(t){this.loadingService.open(),(this.tagId&&"edit"===this.changeRouteName?this.tagManageService.updateTagSetting(this.tagId,t):this.tagManageService.createTagSetting(t)).pipe((0,Q.K)(t=>{throw this.dialogService.alertAndBackToList(!1,`${this.actionName}\u5931\u6557 ${t.message}`,["pages","tag-manage","tag-set",...this.tagId?[this.changeRouteName,this.tagId]:[]]),new Error(t.message)}),(0,E.h)(t=>t.code===M.$.SUCCESS),(0,V.b)(()=>{this.dialogService.alertAndBackToList(!0,`${this.actionName}\u6a19\u7c64\u9001\u5be9\u6210\u529f`,["pages","tag-manage","tag-list"])}),(0,B.x)(()=>{this.loadingService.close()})).subscribe()}getRequestData(){const t=this.validateForm.getRawValue();if(!t)return;let i=new J(t);return i.startDate=U(t.startDate).format("YYYY-MM-DD"),i.endDate=U(t.endDate).format("YYYY-MM-DD"),this.needCleanParam(i,["uploadType","fileName","fileData","conditionSettingMethod","conditionSettingQuery","tagConditionSetting"]),t.tagType===p.hu.document?(i.uploadType=this.uploadType,i.fileName=this.uploadFileName,i.fileData=this.fileData):t.tagType===p.hu.normal&&t.conditionSettingMethod===p.Nl.normal?(i.conditionSettingMethod=t.conditionSettingMethod,i.conditionSettingQuery=t.conditionSettingQuery):t.tagType===p.hu.normal&&t.conditionSettingMethod===p.Nl.field&&Array.isArray(t.tagConditionSetting)&&(i.conditionSettingMethod=t.conditionSettingMethod,i.tagConditionSetting=t.tagConditionSetting.map(i=>{var e;const n=i.id;return new D({tagId:this.tagId,groupId:1,conditionKey:null===(e=this.filterConditionKeyList.find(i=>i.val===t.conditionKey))||void 0===e?void 0:e.key,detectionCondition:i["detectionCondition_"+n],thresholdValue:i["thresholdValue_"+n],joinValue:i["joinValue_"+n]})})),console.info("reqData",i),i}needCleanParam(t,i){i.forEach(i=>{t[i]=null})}setData(t){var i;this.detail=JSON.parse(JSON.stringify(t));const e=f.l.getHistoryProcessData("tagReviewHistoryAud",t);Object.keys(t).forEach(i=>{if(this.validateForm.controls[i])switch(i){case"startDate":case"endDate":this.validateForm.controls[i].setValue(new Date(t[i]));break;case"tagConditionSetting":this.conditions.removeAt(0),this.createConditionControl(t.tagConditionSetting);break;default:this.validateForm.controls[i].setValue(t[i])}}),e&&"edit"===this.changeRouteName&&(this.isHistoryOpen=e.isHistoryOpen,this.detail.historyGroupView=null===(i=e.detail)||void 0===i?void 0:i.historyGroupView)}}return t.\u0275fac=function(i){return new(i||t)(u.Y36(b.V),u.Y36(T.E),u.Y36(x.r),u.Y36(c.F0),u.Y36(c.gz),u.Y36(A.P),u.Y36(tt.I),u.Y36(it.b),u.Y36(et.x),u.Y36(q.I))},t.\u0275cmp=u.Xpm({type:t,selectors:[["tag-set"]],features:[u.qOj],decls:32,vars:28,consts:[[1,"pageTitle"],[1,"pageContent"],["class","noteText",4,"ngIf"],[3,"formGroup"],[1,"row"],["title","\u6a19\u7c64\u540d\u7a31","ctlName","tagName",1,"col-12","col-lg-6",3,"form"],["title","\u72c0\u614b","ctlName","status",1,"col-12","col-lg-6",3,"form","selectList"],["title","\u6a19\u7c64\u985e\u578b","ctlName","tagType",1,"col-12","col-lg-6",3,"form","selectList","valueChange"],[4,"ngIf"],["class","fieldGroup essential col-12 col-lg-6",3,"ngClass",4,"ngIf"],[3,"form"],["title","\u6a19\u7c64\u69cb\u9762","ctlName","categoryKey",1,"col-12","col-lg-6",3,"form","selectList"],["title","\u6a19\u7c64\u5b50\u69cb\u9762","ctlName","tagTopicKey",1,"col-12","col-lg-6",3,"form","selectList"],["title","\u63cf\u8ff0\u8aaa\u660e","ctlName","tagDescription",1,"col-12","col-lg-6",3,"form"],[1,"btnGroup"],["nbButton","","status","basic","size","medium",3,"click"],["nbButton","","status","primary","size","medium",3,"disabled","click"],[1,"noteText"],["icon","info-outline"],["title","\u689d\u4ef6\u8a2d\u5b9a\u65b9\u5f0f","ctlName","conditionSettingMethod",1,"essential","col-12","col-lg-6",3,"form","selectList","valueChange"],[1,"fieldGroup","essential","col-12","col-lg-6",3,"ngClass"],["nbInput","","fullWidth","","type","text","formControlName","fileName","placeholder","\u8acb\u4e0a\u50b3\u6a94\u6848",3,"status"],["nbInput","","fullWidth","","type","file",3,"accept","change"],["nbButton","","status","warning","size","tiny",1,"iconBtn"],["icon","folder-add-outline"],[1,"note","errorText"],["icon","alert-triangle"],[1,"note"],["icon","alert-circle"],[1,"fieldGroup","essential","col-12",3,"ngClass"],["nbInput","","fullWidth","","placeholder","\u8acb\u8f38\u5165","formControlName","conditionSettingQuery",3,"status"],[1,"subTitle"],["class","row",4,"ngIf"],["class","colorArea","formArrayName","tagConditionSetting",4,"ngFor","ngForOf"],[1,"fieldGroup","essential","col-12","col-lg-12",3,"ngClass"],["nbInput","","fullWidth","","type","text","placeholder","\u8acb\u8f38\u5165\u6216\u9078\u64c7","formControlName","conditionKey",3,"status","keyup","click",4,"ngIf"],["nbInput","","fullWidth","","type","text","placeholder","\u8acb\u8f38\u5165\u6216\u9078\u64c7","formControlName","conditionKey",3,"nbAutocomplete","status","input","blur",4,"ngIf"],[3,"selectedChange"],["auto",""],[3,"value",4,"ngFor","ngForOf"],[1,"rightBox","fieldBtn"],["nbButton","",1,"mar_0",3,"status","disabled","click"],["icon","bar-chart-outline"],["nbInput","","fullWidth","","type","text","placeholder","\u8acb\u8f38\u5165\u6216\u9078\u64c7","formControlName","conditionKey",3,"status","keyup","click"],["nbInput","","fullWidth","","type","text","placeholder","\u8acb\u8f38\u5165\u6216\u9078\u64c7","formControlName","conditionKey",3,"nbAutocomplete","status","input","blur"],[3,"value"],["formArrayName","tagConditionSetting",1,"colorArea"],[1,"row",3,"formGroupName"],["title","\u689d\u4ef6\u503c",1,"col-6","col-lg-4",3,"form","ctlName","selectList"],["title","\u9580\u6abb\u503c","type","number",1,"col-6","col-lg-4",3,"form","ctlName"],["class","col-11 col-lg-3",4,"ngIf"],["class","col-11 col-lg-3","title","\u96c6\u5408",3,"form","ctlName","selectList",4,"ngIf"],[1,"fieldBtn","col-1","col-lg-1","mar_t_1d","jc_end"],["nbButton","","status","success","size","tiny","class","iconBtn",3,"disabled","click",4,"ngIf"],["nbButton","","status","danger","size","tiny","class","iconBtn",3,"click",4,"ngIf"],[1,"col-11","col-lg-3"],["title","\u96c6\u5408",1,"col-11","col-lg-3",3,"form","ctlName","selectList"],["nbButton","","status","success","size","tiny",1,"iconBtn",3,"disabled","click"],["icon","plus-outline"],["nbButton","","status","danger","size","tiny",1,"iconBtn",3,"click"],["icon","minus-outline"],["tabTitle","\u7570\u52d5\u6b77\u7a0b"],["class","historyList",4,"ngIf"],["tabTitle","\u6a19\u7c64\u4f7f\u7528\u7bc4\u570d",4,"ngIf"],[1,"historyList"],[4,"ngFor","ngForOf"],["class","historyItem active moreBtn",3,"ngClass",4,"ngIf"],[1,"historyItem","active","moreBtn",3,"ngClass"],[1,"mainItem"],[3,"click"],["nbButton","","ghost","","status","info","size","tiny",1,"iconBtn",3,"click"],["icon","arrow-ios-forward"],["class","subItem",3,"ngClass",4,"ngFor","ngForOf"],[1,"subItem",3,"ngClass"],["tabTitle","\u6a19\u7c64\u4f7f\u7528\u7bc4\u570d"],[3,"settings","source"],[3,"source","paginator"]],template:function(t,i){if(1&t&&(u.TgZ(0,"div",0),u.TgZ(1,"h1"),u._uU(2,"\u6a19\u7c64\u7ba1\u7406"),u.qZA(),u.qZA(),u.TgZ(3,"div",1),u.YNc(4,ot,4,0,"div",2),u.TgZ(5,"nb-card"),u.TgZ(6,"nb-card-header"),u.TgZ(7,"h2"),u._uU(8),u.qZA(),u.qZA(),u.TgZ(9,"nb-card-body",3),u.TgZ(10,"div",4),u._UZ(11,"basic-input",5),u._UZ(12,"radio",6),u.qZA(),u.TgZ(13,"div",4),u.TgZ(14,"radio",7),u.NdJ("valueChange",function(t){return i.changeTagType(t)}),u.qZA(),u.YNc(15,lt,2,4,"div",8),u.YNc(16,rt,16,7,"div",9),u.qZA(),u._UZ(17,"date-range",10),u.TgZ(18,"div",4),u._UZ(19,"dropdown",11),u._UZ(20,"dropdown",12),u.qZA(),u.TgZ(21,"div",4),u._UZ(22,"basic-input",13),u.qZA(),u.YNc(23,dt,12,4,"div",8),u.YNc(24,Zt,7,4,"div",8),u.qZA(),u.qZA(),u.YNc(25,St,6,2,"nb-card",8),u.TgZ(26,"div",4),u.TgZ(27,"div",14),u.TgZ(28,"button",15),u.NdJ("click",function(){return i.cancel()}),u._uU(29,"\u53d6 \u6d88"),u.qZA(),u.TgZ(30,"button",16),u.NdJ("click",function(){return i.submit()}),u._uU(31,"\u9001 \u5be9"),u.qZA(),u.qZA(),u.qZA(),u.qZA()),2&t){let t,e,n,o,a;u.xp6(4),u.Q6J("ngIf","edit"===i.params.changeRoute&&"document"===(null==(t=i.validateForm.get("tagType"))?null:t.value)),u.xp6(4),u.hij("",i.actionName,"\u6a19\u7c64"),u.xp6(1),u.Q6J("formGroup",i.validateForm),u.xp6(2),u.Q6J("form",i.validateForm),u.xp6(1),u.Q6J("form",i.validateForm)("selectList",u.VKq(20,at,i.statusList)),u.xp6(2),u.Q6J("form",i.validateForm)("selectList",u.VKq(22,at,i.tagTypeList)),u.xp6(1),u.Q6J("ngIf","normal"===(null==(e=i.validateForm.get("tagType"))?null:e.value)),u.xp6(1),u.Q6J("ngIf","document"===(null==(n=i.validateForm.get("tagType"))?null:n.value)),u.xp6(1),u.Q6J("form",i.validateForm),u.xp6(2),u.Q6J("form",i.validateForm)("selectList",u.VKq(24,at,i.categoryList)),u.xp6(1),u.Q6J("form",i.validateForm)("selectList",u.VKq(26,at,i.subCategoryList)),u.xp6(2),u.Q6J("form",i.validateForm),u.xp6(1),u.Q6J("ngIf","normal"===(null==(o=i.validateForm.get("conditionSettingMethod"))?null:o.value)),u.xp6(1),u.Q6J("ngIf","field"===(null==(a=i.validateForm.get("conditionSettingMethod"))?null:a.value)),u.xp6(1),u.Q6J("ngIf","edit"===i.params.changeRoute),u.xp6(5),u.Q6J("disabled",i.validateForm.invalid)}},directives:[I.O5,s.Asz,s.ndF,s.yKW,o.JL,o.sg,S.n,nt.U,C.S,w.J,s.DPz,s.fMN,I.mk,s.h8i,o.Fj,o.JJ,o.u,I.sg,s.Xh,s.wNd,s.q51,o.CE,o.x0,s.kyn,s.TR4,r.T5,N.J],pipes:[I.Nd,I.uU],styles:[".fieldBtn [nbButton].status-basic{color:#b7bfc6!important;border:0;background-color:initial!important;padding:.5rem 1rem .5rem 0!important}  .errorText{font-size:.75rem}"]}),t})();var Ct=e(76621),It=e(28668),Nt=e(87450);function Ft(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"button",13),u.NdJ("click",function(){return u.CHM(t),u.oxw().edit()}),u._UZ(1,"nb-icon",14),u.qZA()}if(2&t){const t=u.oxw();u.Q6J("status","reviewing"===(null==t.detail?null:t.detail.reviewStatus)?"basic":"primary")("disabled","reviewing"===(null==t.detail?null:t.detail.reviewStatus))}}function _t(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"button",13),u.NdJ("click",function(){return u.CHM(t),u.oxw().copy()}),u._UZ(1,"nb-icon",15),u.qZA()}if(2&t){const t=u.oxw();u.Q6J("status","reviewing"===(null==t.detail?null:t.detail.reviewStatus)?"basic":"primary")("disabled","reviewing"===(null==t.detail?null:t.detail.reviewStatus))}}function kt(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"div",4),u.TgZ(1,"p",5),u._uU(2,"\u540d\u55ae\u4e0a\u50b3\uff1a"),u.qZA(),u.TgZ(3,"a",16),u.NdJ("click",function(){u.CHM(t);const i=u.oxw();return i.isfileDownload?i.onDownloadFile():null}),u._uU(4),u.qZA(),u.qZA()}if(2&t){const t=u.oxw();u.xp6(3),u.Q6J("ngClass",t.isfileDownload?"link-style":"disabled-link-style"),u.xp6(1),u.Oqu(null==t.detail?null:t.detail.fileName)}}function Kt(t,i){1&t&&(u.TgZ(0,"div",20),u.TgZ(1,"p"),u._uU(2,"\u689d\u4ef6\u8a2d\u5b9a"),u.qZA(),u.qZA())}function Dt(t,i){if(1&t&&(u.TgZ(0,"div",21),u.TgZ(1,"p",5),u._uU(2,"\u689d\u4ef6\u8a2d\u5b9a\uff1a"),u.qZA(),u.TgZ(3,"pre"),u._uU(4),u.qZA(),u.qZA()),2&t){const t=u.oxw(2);u.xp6(4),u.Oqu(null==t.detail?null:t.detail.conditionSettingQuery)}}function Lt(t,i){if(1&t&&(u.TgZ(0,"div",21),u.TgZ(1,"p",5),u._uU(2,"\u5075\u6e2c\u689d\u4ef6\uff1a"),u.qZA(),u.TgZ(3,"span"),u._uU(4),u.qZA(),u.qZA()),2&t){const t=u.oxw(2);u.xp6(4),u.Oqu((null==t.detail||null==t.detail.tagConditionSetting||null==t.detail.tagConditionSetting[0]?null:t.detail.tagConditionSetting[0].conditionName)||(null==t.detail||null==t.detail.tagConditionSetting||null==t.detail.tagConditionSetting[0]?null:t.detail.tagConditionSetting[0].conditionKey))}}function Jt(t,i){1&t&&u._UZ(0,"nb-tag",27)}function Mt(t,i){1&t&&u._UZ(0,"nb-tag",28)}function Ot(t,i){if(1&t&&(u.ynx(0),u.TgZ(1,"div",24),u.TgZ(2,"p"),u._uU(3),u.ALo(4,"enum"),u.qZA(),u.TgZ(5,"span"),u._uU(6),u.qZA(),u.YNc(7,Jt,1,0,"nb-tag",25),u.YNc(8,Mt,1,0,"nb-tag",26),u.qZA(),u.BQk()),2&t){const t=i.$implicit;u.xp6(3),u.Oqu(u.xi3(4,4,null==t||null==t.detectionCondition?null:t.detectionCondition.toLowerCase(),"mathSymbol")),u.xp6(3),u.Oqu(null==t?null:t.thresholdValue),u.xp6(1),u.Q6J("ngIf","and"===(null==t||null==t.joinValue?null:t.joinValue.toLowerCase())),u.xp6(1),u.Q6J("ngIf","or"===(null==t||null==t.joinValue?null:t.joinValue.toLowerCase()))}}function Ut(t,i){if(1&t&&(u.TgZ(0,"div",22),u.TgZ(1,"div",3),u.YNc(2,Ot,9,7,"ng-container",23),u.qZA(),u.qZA()),2&t){const t=u.oxw(2);u.xp6(2),u.Q6J("ngForOf",null==t.detail?null:t.detail.tagConditionSetting)}}function Qt(t,i){if(1&t&&(u.TgZ(0,"div"),u.YNc(1,Kt,3,0,"div",17),u.TgZ(2,"div",3),u.YNc(3,Dt,5,1,"div",18),u.YNc(4,Lt,5,1,"div",18),u.YNc(5,Ut,3,1,"div",19),u.qZA(),u.qZA()),2&t){const t=u.oxw();u.xp6(1),u.Q6J("ngIf","field"===(null==t.detail?null:t.detail.conditionSettingMethod)),u.xp6(2),u.Q6J("ngIf","normal"===(null==t.detail?null:t.detail.conditionSettingMethod)),u.xp6(1),u.Q6J("ngIf","field"===(null==t.detail?null:t.detail.conditionSettingMethod)),u.xp6(1),u.Q6J("ngIf","field"===(null==t.detail?null:t.detail.conditionSettingMethod))}}function Et(t,i){if(1&t&&(u.TgZ(0,"div",37),u.TgZ(1,"div"),u.TgZ(2,"p"),u._uU(3),u.ALo(4,"date"),u.qZA(),u.TgZ(5,"p"),u._uU(6),u.ALo(7,"date"),u.qZA(),u.qZA(),u.TgZ(8,"div"),u.TgZ(9,"p"),u._uU(10),u.qZA(),u.TgZ(11,"p"),u._uU(12),u.qZA(),u.qZA(),u.qZA()),2&t){const t=i.$implicit,e=u.oxw(2).$implicit,n=u.oxw(2);u.Q6J("ngClass",n.isHistoryOpen[e.key]?"":"dis_none"),u.xp6(3),u.Oqu(u.xi3(4,5,t.time,n.dateFormat)),u.xp6(3),u.Oqu(u.xi3(7,8,t.time,"hh:mm:ss")),u.xp6(4),u.Oqu(t.title),u.xp6(2),u.Oqu(t.detail)}}function Vt(t,i){if(1&t){const t=u.EpF();u.TgZ(0,"div",31),u.TgZ(1,"div",32),u.TgZ(2,"h4",33),u.NdJ("click",function(){u.CHM(t);const i=u.oxw().$implicit,e=u.oxw(2);return e.isHistoryOpen[i.key]=!e.isHistoryOpen[i.key]}),u._uU(3),u.qZA(),u.TgZ(4,"button",34),u.NdJ("click",function(){u.CHM(t);const i=u.oxw().$implicit,e=u.oxw(2);return e.isHistoryOpen[i.key]=!e.isHistoryOpen[i.key]}),u._UZ(5,"nb-icon",35),u.qZA(),u.qZA(),u.YNc(6,Et,13,11,"div",36),u.qZA()}if(2&t){const t=i.ngIf,e=u.oxw().$implicit,n=u.oxw(2);u.Q6J("ngClass",n.isHistoryOpen[e.key]?"closeSubItem":""),u.xp6(3),u.Oqu(t.type),u.xp6(3),u.Q6J("ngForOf",t.flows)}}function Bt(t,i){if(1&t&&(u.ynx(0),u.YNc(1,Vt,7,3,"div",30),u.BQk()),2&t){const t=i.$implicit;u.xp6(1),u.Q6J("ngIf",t.value)}}function Yt(t,i){if(1&t&&(u.TgZ(0,"div",29),u.YNc(1,Bt,2,1,"ng-container",23),u.ALo(2,"keyvalue"),u.qZA()),2&t){const t=u.oxw();u.xp6(1),u.Q6J("ngForOf",u.lcZ(2,1,t.detail.historyGroupView))}}function Ht(t,i){if(1&t&&(u.TgZ(0,"nb-tab",38),u._UZ(1,"ng2-smart-table",39),u._UZ(2,"paginator",40),u.qZA()),2&t){const t=i.ngIf,e=u.oxw();u.xp6(1),u.Q6J("settings",e.gridDefine)("source",t),u.xp6(1),u.Q6J("source",t)("paginator",e.paginator)}}let Pt=(()=>{class t extends y.H{constructor(t,i,e,n,o,a,l,s,r,d){super(t,i,e),this.router=n,this.fileService=o,this.activatedRoute=a,this.tagManageService=l,this.dialogService=s,this.loadingService=r,this.tableService=d,this.isHistoryOpen={},this.fileName="",this.isfileDownload=!1,this.gridDefine={pager:{display:!0,perPage:10},columns:{activityName:{title:"\u6d3b\u52d5\u540d\u7a31",type:"string",sort:!1},activityDescription:{title:"\u6d3b\u52d5\u8aaa\u660e",type:"html",sort:!1,valuePrepareFunction:t=>`<p>${null!=t?t:""}</p>`},department:{title:"\u6240\u5c6c\u55ae\u4f4d",type:"html",class:"text_center",valuePrepareFunction:(t,i)=>t?'<p class="text_center">'+(null!=t?t:"")+"</p>":"",sort:!1},owner:{title:"\u8ca0\u8cac\u4eba",type:"html",class:"text_center",valuePrepareFunction:(t,i)=>t?'<p class="text_center">'+(null!=t?t:"")+"</p>":"",sort:!1},status:{title:"\u72c0\u614b",type:"html",class:"text_center",valuePrepareFunction:(t,i)=>`<p class="text_center">${h.qb[i.reviewStatus]||h.qb[t]||""}</p>`,sort:!1},during:{title:"\u8d77\u8fc4\u6642\u9593",type:"html",class:"text_center",valuePrepareFunction:(t,i)=>i.startDate&&i.endDate?`<p class="text_center">${null==i?void 0:i.startDate} ~ ${null==i?void 0:i.endDate}</p>`:"",sort:!1}},hideSubHeader:!0,actions:{add:!1,edit:!1,delete:!1}}}ngOnInit(){var t;if(this.tagId=this.activatedRoute.snapshot.params.tagId,this.isMock){let i=Z.O.find(t=>t.tagId===this.tagId);this.detail=JSON.parse(JSON.stringify(i));const e=f.l.getHistoryProcessData("tagReviewHistoryAud",i);return e&&(this.isHistoryOpen=e.isHistoryOpen,this.detail.historyGroupView=null===(t=e.detail)||void 0===t?void 0:t.historyGroupView),this.loadingService.close(),void this.dataSource.load(R.w)}this.loadingService.open(),this.tagManageService.getTagSettingRow(this.tagId).pipe((0,Q.K)(t=>{throw this.dialogService.alertAndBackToList(!1,"\u67e5\u7121\u6b64\u7b46\u8cc7\u6599\uff0c\u5c07\u70ba\u60a8\u5c0e\u56de\u6a19\u7c64\u7ba1\u7406",["pages","tag-manage","tag-list"]),new Error(t.message)}),(0,E.h)(t=>t.code===M.$.SUCCESS),(0,V.b)(t=>{var i,e,n,o,a,l;this.detail=JSON.parse(JSON.stringify(t.result)),console.info("this.detail",this.detail);const s=f.l.getHistoryProcessData("tagReviewHistoryAud",t.result);s&&(this.isHistoryOpen=s.isHistoryOpen,this.detail.historyGroupView=null===(i=s.detail)||void 0===i?void 0:i.historyGroupView),this.isfileDownload=(null===(o=null===(n=null===(e=this.loginService.userProfileSubject)||void 0===e?void 0:e.value)||void 0===n?void 0:n.businessUnit)||void 0===o?void 0:o.toLowerCase())===(null===(l=null===(a=this.detail)||void 0===a?void 0:a.department)||void 0===l?void 0:l.toLocaleLowerCase())}),(0,B.x)(()=>this.loadingService.close())).subscribe(),this.restDataSource=this.tableService.searchData({apiUrl:`${this.tagManageService.tagFunc}${this.tagId}/activity-setting`,nowPage:this.paginator.nowPage,errMsg:"\u6a19\u7c64\u4f7f\u7528\u7bc4\u570d\u67e5\u7121\u8cc7\u6599"})}onDownloadFile(){var t,i,e;f.l.isBlank(null===(t=this.detail)||void 0===t?void 0:t.fileData)?this.dialogService.alertAndBackToList(!1,"\u6a94\u6848\u4e0b\u8f09\u5931\u6557(\u7121\u8b58\u5225\u78bc)"):this.fileService.downloadFileService(It.s.Tag,new Ct.D({fileDataId:this.detail.fileData,fileName:null===(i=this.detail)||void 0===i?void 0:i.fileName,uploadType:null===(e=this.detail)||void 0===e?void 0:e.uploadType}))}edit(){this.router.navigate(["pages","tag-manage","tag-set","edit",this.detail.tagId])}copy(){this.router.navigate(["pages","tag-manage","tag-set","copy",this.detail.tagId])}cancel(){this.router.navigate(["pages","tag-manage","tag-list"])}}return t.\u0275fac=function(i){return new(i||t)(u.Y36(b.V),u.Y36(T.E),u.Y36(x.r),u.Y36(c.F0),u.Y36(tt.I),u.Y36(c.gz),u.Y36(A.P),u.Y36(et.x),u.Y36(it.b),u.Y36(q.I))},t.\u0275cmp=u.Xpm({type:t,selectors:[["tag-detail"]],features:[u.qOj],decls:77,vars:26,consts:[[1,"pageTitle"],["nbButton","","size","tiny","class","iconBtn",3,"status","disabled","click",4,"ngIf"],[1,"pageContent"],[1,"row"],[1,"textGroup","col-12","col-lg-4"],[1,"text_bold"],["class","textGroup col-12 col-lg-4",4,"ngIf"],[4,"ngIf"],["tabTitle","\u7570\u52d5\u6b77\u7a0b"],["class","historyList",4,"ngIf"],["tabTitle","\u6a19\u7c64\u4f7f\u7528\u7bc4\u570d",4,"ngIf"],[1,"btnGroup"],["nbButton","","status","basic","size","medium",3,"click"],["nbButton","","size","tiny",1,"iconBtn",3,"status","disabled","click"],["icon","edit-outline"],["icon","copy-outline"],[3,"ngClass","click"],["class","subTitle",4,"ngIf"],["class","textGroup code col-12",4,"ngIf"],["class","colorArea col-12",4,"ngIf"],[1,"subTitle"],[1,"textGroup","code","col-12"],[1,"colorArea","col-12"],[4,"ngFor","ngForOf"],[1,"textGroup","gather"],["status","warning","appearance","filled","text","and",4,"ngIf"],["status","info","appearance","filled","text","or",4,"ngIf"],["status","warning","appearance","filled","text","and"],["status","info","appearance","filled","text","or"],[1,"historyList"],["class","historyItem active moreBtn",3,"ngClass",4,"ngIf"],[1,"historyItem","active","moreBtn",3,"ngClass"],[1,"mainItem"],[3,"click"],["nbButton","","ghost","","status","info","size","tiny",1,"iconBtn",3,"click"],["icon","arrow-ios-forward"],["class","subItem",3,"ngClass",4,"ngFor","ngForOf"],[1,"subItem",3,"ngClass"],["tabTitle","\u6a19\u7c64\u4f7f\u7528\u7bc4\u570d"],[3,"settings","source"],[3,"source","paginator"]],template:function(t,i){1&t&&(u.TgZ(0,"div",0),u.TgZ(1,"h1"),u._uU(2,"\u6a19\u7c64\u7ba1\u7406"),u.qZA(),u.YNc(3,Ft,2,2,"button",1),u.YNc(4,_t,2,2,"button",1),u.qZA(),u.TgZ(5,"div",2),u.TgZ(6,"nb-card"),u.TgZ(7,"nb-card-body"),u.TgZ(8,"div",3),u.TgZ(9,"div",4),u.TgZ(10,"p",5),u._uU(11,"\u6a19\u7c64\u540d\u7a31\uff1a"),u.qZA(),u.TgZ(12,"span"),u._uU(13),u.qZA(),u.qZA(),u.TgZ(14,"div",4),u.TgZ(15,"p",5),u._uU(16,"\u72c0\u614b\uff1a"),u.qZA(),u.TgZ(17,"span"),u._uU(18),u.ALo(19,"enum"),u.qZA(),u.qZA(),u.TgZ(20,"div",4),u.TgZ(21,"p",5),u._uU(22,"\u985e\u578b\uff1a"),u.qZA(),u.TgZ(23,"span"),u._uU(24),u.ALo(25,"enum"),u.qZA(),u.qZA(),u.qZA(),u.TgZ(26,"div",3),u.TgZ(27,"div",4),u.TgZ(28,"p",5),u._uU(29,"\u6240\u5c6c\u55ae\u4f4d\uff1a"),u.qZA(),u.TgZ(30,"span"),u._uU(31),u.qZA(),u.qZA(),u.TgZ(32,"div",4),u.TgZ(33,"p",5),u._uU(34,"\u8ca0\u8cac\u4eba\uff1a"),u.qZA(),u.TgZ(35,"span"),u._uU(36),u.qZA(),u.qZA(),u.TgZ(37,"div",4),u.TgZ(38,"p",5),u._uU(39,"\u8d77\u8fc4\u6642\u9593\uff1a"),u.qZA(),u.TgZ(40,"span"),u._uU(41),u.qZA(),u.qZA(),u.qZA(),u.TgZ(42,"div",3),u.TgZ(43,"div",4),u.TgZ(44,"p",5),u._uU(45,"\u6a19\u7c64\u69cb\u9762\uff1a"),u.qZA(),u.TgZ(46,"span"),u._uU(47),u.qZA(),u.qZA(),u.TgZ(48,"div",4),u.TgZ(49,"p",5),u._uU(50,"\u6a19\u7c64\u5b50\u69cb\u9762\uff1a"),u.qZA(),u.TgZ(51,"span"),u._uU(52),u.qZA(),u.qZA(),u.TgZ(53,"div",4),u.TgZ(54,"p",5),u._uU(55,"\u7570\u52d5\u6642\u9593\uff1a"),u.qZA(),u.TgZ(56,"span"),u._uU(57),u.ALo(58,"date"),u.qZA(),u.qZA(),u.qZA(),u.TgZ(59,"div",3),u.TgZ(60,"div",4),u.TgZ(61,"p",5),u._uU(62,"\u63cf\u8ff0\u8aaa\u660e\uff1a"),u.qZA(),u.TgZ(63,"span"),u._uU(64),u.qZA(),u.qZA(),u.YNc(65,kt,5,2,"div",6),u.qZA(),u.YNc(66,Qt,6,4,"div",7),u.qZA(),u.qZA(),u.TgZ(67,"nb-card"),u.TgZ(68,"nb-card-body"),u.TgZ(69,"nb-tabset"),u.TgZ(70,"nb-tab",8),u.YNc(71,Yt,3,3,"div",9),u.qZA(),u.YNc(72,Ht,3,4,"nb-tab",10),u.qZA(),u.qZA(),u.qZA(),u.TgZ(73,"div",3),u.TgZ(74,"div",11),u.TgZ(75,"button",12),u.NdJ("click",function(){return i.cancel()}),u._uU(76,"\u8fd4 \u56de"),u.qZA(),u.qZA(),u.qZA(),u.qZA()),2&t&&(u.xp6(3),u.Q6J("ngIf",i.isCrud.update),u.xp6(1),u.Q6J("ngIf",i.isCrud.create),u.xp6(9),u.Oqu(null==i.detail?null:i.detail.tagName),u.xp6(5),u.Oqu(u.xi3(19,17,null==i.detail?null:i.detail.status,"status")),u.xp6(6),u.Oqu(u.xi3(25,20,null==i.detail?null:i.detail.tagType,"tagType")),u.xp6(7),u.Oqu(null==i.detail?null:i.detail.department),u.xp6(5),u.Oqu(null==i.detail?null:i.detail.owner),u.xp6(5),u.AsE("",null==i.detail?null:i.detail.startDate,"~",null==i.detail?null:i.detail.endDate,""),u.xp6(6),u.Oqu((null==i.detail?null:i.detail.categoryName)||(null==i.detail?null:i.detail.categoryKey)),u.xp6(5),u.Oqu((null==i.detail?null:i.detail.tagTopicName)||(null==i.detail?null:i.detail.tagTopicKey)),u.xp6(5),u.Oqu(u.xi3(58,23,null==i.detail?null:i.detail.modificationTime,i.dateFormat)),u.xp6(7),u.Oqu(null==i.detail?null:i.detail.tagDescription),u.xp6(1),u.Q6J("ngIf","document"===(null==i.detail?null:i.detail.tagType)),u.xp6(1),u.Q6J("ngIf","document"!==(null==i.detail?null:i.detail.tagType)&&("field"===(null==i.detail?null:i.detail.conditionSettingMethod)||"normal"===(null==i.detail?null:i.detail.conditionSettingMethod))),u.xp6(5),u.Q6J("ngIf",null==i.detail?null:i.detail.historyGroupView),u.xp6(1),u.Q6J("ngIf",i.restDataSource||i.dataSource))},directives:[I.O5,s.Asz,s.yKW,s.kyn,s.TR4,s.DPz,s.fMN,I.mk,I.sg,s.c2L,r.T5,N.J],pipes:[Nt.z,I.uU,I.Nd],styles:[".link-style[_ngcontent-%COMP%]{color:#26dd84!important;text-decoration:none;cursor:pointer}.disabled-link-style[_ngcontent-%COMP%]{color:gray!important;text-decoration:none;cursor:not-allowed}"]}),t})();var $t=e(22191);const jt=[{path:"",component:g,children:[{path:"",redirectTo:"tag-list",pathMatch:"full"},{path:"tag-list",component:K,data:{keepSession:!0}},{path:"tag-detail/:tagId",component:Pt,data:{keepSession:!0}},{path:"tag-set",component:wt},{path:"tag-set/:changeRoute/:tagId",component:wt}]}];let Gt=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({providers:[{provide:$t.Q}],imports:[[c.Bz.forChild(jt)],c.Bz]}),t})();var Rt=e(83621);const zt=[s.uuI,s.zyh,s.caZ,s.KdK,l.$,s.MfT,s.YNG,s.nKr,s.T2N,s.IIj,s.OA,s.oGl,a.k.forChild({format:"yyyy-MM-dd"}),s.j7H.forChild(),s.urD,s.CG_,s.EoG];let Wt=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({providers:[A.P],imports:[[n.e,o.u5,o.UX,d.O,Gt,r.ne,H.N,Rt.Dv,...zt]]}),t})()}}]);